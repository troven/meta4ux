var jsPlumbToolkitUtil=(typeof module!=="undefined"&&module.exports)||{};(function(a){a.version="0.1";a.name="jsPlumbToolkitUtil";a.fastTrim=function(d){var e=d.replace(/^\s\s*/,""),b=/\s/,c=e.length;while(b.test(e.charAt(--c))){}return e.slice(0,c+1)};a.uuid=function(){return("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var d=Math.random()*16|0,b=e=="x"?d:(d&3|8);return b.toString(16)}))};a.getInternetExplorerVersion=function(){var d=-1;if(navigator.appName=="Microsoft Internet Explorer"){var b=navigator.userAgent;var c=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(c.exec(b)!=null){d=parseFloat(RegExp.$1)}}return d};a.populate=function(d,c){var b=function(j){var g=j.match(/(\${.*?})/g);if(g!=null){for(var f=0;f<g.length;f++){var h=c[g[f].substring(2,g[f].length-1)];if(h){j=j.replace(g[f],h)}}}return j},e=function(h){if(h!=null){if(jsPlumbUtil.isString(h)){return b(h)}else{if(jsPlumbUtil.isArray(h)){var g=[];for(var f=0;f<h.length;f++){g.push(e(h[f]))}return g}else{if(jsPlumbUtil.isObject(h)){var g={};for(var f in h){g[f]=e(h[f])}return g}else{return h}}}}};return e(d)};a.mergeWithParents=function(e,g,b){b=b||"parent";var f=function(d){return d?g[d]:null};var i=function(d){return d?f(d[b]):null};var c=function(j,k){if(j==null){return k}else{var l=jsPlumbUtil.merge(j,k);return c(i(j),l)}};var h=f(e);if(h){return c(i(h),h)}else{return{}}};a.xml={setNodeText:function(b,d){b.text=d;try{b.textContent=d}catch(c){}},getNodeText:function(b){return b!=null?b.text||b.textContent:""},getChild:function(e,b){var f=null;for(var d=0;d<e.childNodes.length;d++){if(e.childNodes[d].nodeType==1&&e.childNodes[d].nodeName==b){f=e.childNodes[d];break}}return f},getChildren:function(e,b){var f=[];for(var d=0;d<e.childNodes.length;d++){if(e.childNodes[d].nodeType==1&&e.childNodes[d].nodeName==b){f.push(e.childNodes[d])}}return f},xmlToString:function(c){try{return(new XMLSerializer()).serializeToString(c).replace(/\s*xmlns=\"http\:\/\/www.w3.org\/1999\/xhtml\"/g,"")}catch(d){try{return c.xml}catch(b){throw new Error("Cannot serialize XML "+b)}}return false},createElement:function(c,b,g){var h;try{h=new ActiveXObject("Microsoft.XMLDOM").createNode(1,c,"")}catch(f){h=document.createElement(c)}if(g){jsPlumbToolkitUtil.xml.setNodeText(h,g)}if(b){for(var d in b){h.setAttribute(d,b[d])}}return h}}})(jsPlumbToolkitUtil);var jsPlumbGraph=(typeof module!=="undefined"&&module.exports)||{};(function(d){d.version="0.1";d.name="jsPlumbGraph";var e=function(){var m={};this.setAttribute=function(n,o){m[n]=o};this.getAttribute=function(n){return m[n]}},c=function(n,m){return typeof n==="string"?n:m!=null?m(n):n.id},l=function(m){return typeof m==="string"?{id:m}:m},k=d.Vertex=function(s,r){var o=this;e.apply(this,arguments);this.id=c(s,r);this.data=l(s);var n=[],m=0,p=0,q=[],t=[];this.getEdges=function(){return n};this.addEdge=function(u){n.push(u);if(u.source===o||!u.isDirected()){p++}if(u.target===o||!u.isDirected()){m++}};this.deleteEdge=function(w){var u=-1;for(var v=0;v<n.length;v++){if(n[v]._id===w._id){u=v;break}}if(u>-1){n.splice(u,1);if(w.source===o||!w.isDirected()){p--}if(w.target===o||!w.isDirected()){m--}return true}return false};this.getAllEdges=function(){var v=n.slice(0);for(var u=0;u<t.length;u++){v.push.apply(v,t[u].getEdges())}return v};this.getIndegreeCentrality=function(){var u=0;for(var v=0;v<t.length;v++){u+=t[v].getIndegreeCentrality()}return m+u};this.getOutdegreeCentrality=function(){var u=0;for(var v=0;v<t.length;v++){u+=t[v].getOutdegreeCentrality()}return p+u};this.getPorts=function(){return t};this.addPort=function(v,u){var x=c(v,u),w=o.getPort(x);if(w==null){w=new h(v,u,o);t.push(w)}return w};this.setPort=function(w,u){var v=o.getPort(w);if(!v){v=o.addPort({id:w})}v.data=u;return v};this.getPort=function(v){for(var u=0;u<t.length;u++){if(t[u].id===v){return t[u]}}return null};this.removePort=function(v){if(v){var x=v.constructor==jsPlumbGraph.Port?v.id:v,u=-1;for(var w=0;w<t.length;w++){if(t[w].id===x){u=w;break}}if(u!=-1){t.splice(u,1);return true}}return false};this.inspect=function(){var v="{ id:"+id+", edges:[\n";for(var u=0;u<n.length;u++){v+=n[u].inspect()+"\n"}v+="]}";return v}},h=d.Port=function(o,n,m){k.apply(this,arguments);this.getNode=function(){return m};this.getPorts=this.addPort=this.deletePort=this.getPort=null;this.getFullId=function(){return m.id+"."+this.id}},f=d.Edge=function(m,r,o,n){e.apply(this,arguments);this.source=m;this.target=r;var t=this,u=o||1,p=!(n===false),s=null,q=null;this.data={};this.getCost=function(){return u};this.setCost=function(v){u=v};this.getId=function(){return s===null?t.source.id+"_"+t.target.id:s};this.setId=function(v){s=v};this.isDirected=function(){return p};this.inspect=function(){if(s===null){return"{ id:"+s+", connectionId:"+q+", cost:"+u+", directed:"+p+", source:"+t.source.id+", target:"+t.target.id+"}"}}},j=d.Graph=function(p){p=p||{};this.vertices=[];this.edges=[];var q={},o=0,u=0,r=!(p.defaultDirected===false),n=p.defaultCost||1,t=this,s=p.idFunction||function(v){return v.id};t.setIdFunction=function(v){s=v};var m=function(z,w){if(typeof z!="string"){return z}else{var y=z.split("."),A=y[0],v=q[A];if(y.length===2&&v!=null){var x=v.getPort(y[1]);if(x==null&&w){x=v.addPort(y[1])}return x}else{return v}}};this.clear=function(){t.vertices.splice(0,t.vertices.length);o=0;u=0;q={}};this.getVertexCount=function(){return t.vertices.length};this.getVertexAt=function(v){return t.vertices[v]};this.getEdgeCount=function(){return u};this.addEdge=function(x){var w=x.directed==null?r===true:!(x.directed===false),y=x.cost||n,v=new f(m(x.source,true),m(x.target,true),y,w);v.data=x.data||{};v.source.addEdge(v);v.target.addEdge(v);v.setId(u++);return v};this.addVertex=function(y,x){var w=new k(y,x||s);t.vertices.push(w);q[w.id]=w;w._id=o++;return w};this.addVertices=function(x,w){for(var v=0;v<x.length;v++){t.addVertex(x[v],w||s)}};this.deleteVertex=function(C){var z=m(C);if(z){var w=-1;for(var B=0;B<t.vertices.length;B++){if(t.vertices[B].id===z.id){w=B;break}}if(w>-1){t.vertices.splice(w,1)}var y=z.getEdges();for(var A=0;A<y.length;A++){t.deleteEdge(y[A])}u-=y.length;if(z.getPorts){var D=z.getPorts();for(var x=0;x<D.length;x++){t.deleteVertex(D[x])}}delete q[z.id];o--}};this.addNode=this.addVertex;this.addNodes=this.addVertices;this.deleteNode=this.deleteVertex;this.deleteEdge=function(y,x){var w=m(y.source);if(w&&w.deleteEdge(y)){u--}var z=m(y.target);if(z){z.deleteEdge(y)}};this.findPath=function(x,y,v,w){x=m(x);y=m(y);return g.compute({graph:t,source:x,target:y,edgeSelector:v,vertexSelector:w})};this.getDistance=function(x,z,v,w){var y=t.findPath(x,z,v,w);return y.pathDistance};this.getVertex=m;this.printPath=function(x,z){x=m(x);z=m(z);var y=t.findPath(x,z);var w="["+x.id+" - "+z.id+"] : ";for(var v=0;v<y.length;v++){w=w+"{ vertex:"+y[v].vertex.id+", cost:"+y[v].cost+", edge: "+y[v].edge.getId()+" } "}return w};this.getDiameter=function(z){var x=0;for(var w=0;w<t.vertices.length;w++){for(var v=0;v<t.vertices.length;v++){if(v!=w){var y=g.compute({graph:t,source:t.vertices[w],target:t.vertices[v]});if(y.path==null||y.path.length==0){if(!z){return Infinity}}else{x=Math.max(x,y.pathDistance)}}}}return x};this.diameter=this.getDiameter;this.getCentrality=function(w,v){w=m(w);return(w.getIndegreeCentrality()+w.getOutdegreeCentrality())/(t.getVertexCount()-1)};this.getDegreeCentrality=this.getCentrality;this.getIndegreeCentrality=function(v){v=m(v);return v.getIndegreeCentrality()/(t.getVertexCount()-1)};this.getOutdegreeCentrality=function(v){v=m(v);return v.getOutdegreeCentrality()/(t.getVertexCount()-1)};this.getCloseness=function(v){return 1/t.getFarness(v)};this.getFarness=function(x){x=m(x);var y=g.compute({graph:t,source:x,target:x,processAll:true}),w=0;for(var v in y.dist){w+=y.dist[v]}return w/(t.getVertexCount()-1)};this.getBetweenness=function(z){var w=t.getVertexCount(),x=(w-1)*(w-2)/2,v=0,H=0,C=function(L,O,N,K,P){var I=N.parents[L][O];if(I.length==0){var M=K.slice();M.unshift(L);P.push(M)}else{for(var J=0;J<I.length;J++){if(K.indexOf(I[J][0].id)==-1){var M=K.slice();M.unshift(I[J][0].id);C(L,I[J][0].id,N,M,P)}}}};z=m(z);var y=b.compute({graph:t,focus:z});for(var G in y.paths){for(var E in y.paths[G]){if(G!=E){var D=[],B=0;C(G,E,y,[E],D);for(var A=0;A<D.length;A++){var F=D[A].indexOf(z.id);if(F>0&&F<D[A].length-1){B++}}v+=(B/D.length);H+=B}}}return v/x};this.inspect=function(){var w="";for(var v=0;v<t.vertices.length;v++){w+=t.vertices[v].inspect()+"\n"}return w}},i=function(o,n,s){var m=-1,r=null,q=Infinity;for(var p=0;p<o.length;p++){if(!n[p]){if(s[o[p].id]<q){q=s[o[p].id];m=p;r=o[p]}}}return{node:r,index:m}},a=function(r,o,m,q){var p=[],n=q;while(o[n.id]!=null){p.splice(0,0,{vertex:n,cost:r[n.id],edge:m[n.id]});n=o[n.id]}p.splice(0,0,{vertex:n,cost:0,edge:null});return p},g={compute:function(t){var B=t.graph,n=t.source,z=t.target,A={},x={},u={},o={dist:A,previous:x,edges:u,path:[]},m=t.processAll;for(var w=0;w<B.vertices.length;w++){A[B.vertices[w].id]=Infinity}if(n==null){n=B.getVertex(t.sourceId)}if(z==null){z=B.getVertex(t.targetId)}if(n==null||z==null){return o}var r=n,y=z;if(n.getNode){r=n.getNode()}if(z.getNode){y=z.getNode()}A[r.id]=0;var p=new Array(B.vertices.length),v=0,s=function(E,I,G,J){for(var D=0;D<I.length;D++){var F=I[D];if(G(F)){var C=J(F);var H=A[E.node.id]+F.getCost();if(H<A[C.tn.id]){A[C.tn.id]=H;x[C.tn.id]=E.node;u[C.tn.id]=F}}}};while(v<B.vertices.length){var q=i(B.vertices,p,A);if(!q.node||A[q.node.id]==Infinity){break}if(y&&q.node.id==y.id){o.path=a(A,x,u,y);o.pathDistance=o.path[o.path.length-1].cost;if(!m){break}}p[q.index]=true;v=v+1;s(q,q.node.getAllEdges(),function(C){var D=C.source.getNode?C.source.getNode():C.source;return D==q.node||!C.isDirected()},function(E){var G=E.source.getNode?E.source.getNode():E.source,D=E.source.getNode?E.source:null,C=E.target.getNode?E.target.getNode():E.target,F=E.target.getNode?E.target:null;return G==q.node?{tn:C,tp:F}:{tn:G,tp:D}})}return o}},b={getPath:function(q,m,o,p){if(q[o.id][p.id]==Infinity){return null}var n=m[o.id][p.id];if(n==null){return" "}else{return b.getPath(q,m,o,n)+" "+n.id+" "+b.getPath(q,m,n,p)}},getPaths:function(r,m,o,p,q){if(r[o.id][p.id]==Infinity){return null}var n=m[o.id][p.id];if(n.length==0){return" "}else{return b.getPaths(r,m,o,n[0])+" "+n[0].id+" "+b.getPaths(r,m,n[0],p)}},compute:function(p){var A=p.graph,m=A.getVertexCount(),C={},D=p.focus,B=0,t={};for(var s=0;s<m;s++){var y=A.getVertexAt(s);if(!C[y.id]){C[y.id]={}}if(!t[y.id]){t[y.id]={}}C[y.id][y.id]=0;for(var r=0;r<m;r++){if(s!=r){var u=A.getVertexAt(r);if(!C[y.id][u.id]){C[y.id][u.id]=Infinity}if(!t[y.id][u.id]){t[y.id][u.id]=[]}}}var q=y.getEdges();for(var o=0;o<q.length;o++){if(q[o].source==y){C[y.id][q[o].target.id]=q[o].getCost()}else{if(!C[q[o].source.id]){C[q[o].source.id]={};t[q[o].source.id]={}}C[y.id][q[o].source.id]=q[o].getCost()}}}for(var o=0;o<m;o++){for(var s=0;s<m;s++){for(var r=0;r<m;r++){if(s!=r&&r!=o&&s!=o){var z=A.getVertexAt(s).id,x=A.getVertexAt(r).id,w=A.getVertexAt(o).id;if((C[z][w]+C[w][x])<=C[z][x]&&(C[z][w]+C[w][x])!=Infinity){C[z][x]=C[z][w]+C[w][x];if(!t[z][x]){t[z][x]=[]}t[z][x].unshift([A.getVertexAt(o),C[z][x]])}}}}}return{paths:C,parents:t}}}})(jsPlumbGraph);var jsPlumbToolkitIO=(typeof module!=="undefined"&&module.exports)||{};(function(c){c.version="0.1";c.name="jsPlumbToolkitIO";var e=function(l,q){var f=l.nodes||[],k=l.edges||[];for(var m=0;m<f.length;m++){var g=q.addNode(f[m])}for(var h=0;h<k.length;h++){var p=k[h].cost||1,o=(k[h].bidirectional===true);q.addEdge({source:k[h].source,target:k[h].target,cost:p,bidirectional:o,data:k[h]})}},b=function(f){},a=function(F,j){var f=jsPlumbToolkitUtil.xml,y=f.getChild(F.documentElement,"graph");kCache={node:{},edge:{}};if(y){var r=f.getChildren(F.documentElement,"key"),x=f.getChildren(y,"node")||[],h=f.getChildren(y,"edge")||[],k=(y.getAttribute("edgedefault")||"undirected")=="undirected";for(var B=0;B<r.length;B++){var C=r[B].getAttribute("id"),z=r[B].getAttribute("for"),g=r[B].getAttribute("attr.name"),m=r[B].getAttribute("attr.type"),o=f.getChild(r[B],"default");kCache[z][C]={id:C,name:g,type:m,_default:o!=null?f.getNodeText(o):null}}var A=function(s,n){for(var i in kCache[n]){if(kCache[n][i]._default){s.setAttribute(i,kCache[n][i]._default);s.data[i]=kCache[n][i]._default}}},v=function(G,I,t){var H=f.getChildren(G,"data");for(var s=0;s<H.length;s++){var n=kCache[t][H[s].getAttribute("key")];I.setAttribute(n.id,f.getNodeText(H[s]));I.data[n.id]=f.getNodeText(H[s])}};for(var B=0;B<x.length;B++){var w=j.addNode(x[B].getAttribute("id"));w.data={};A(w,"node");v(x[B],w,"node")}for(var B=0;B<h.length;B++){var q=h[B].getAttribute("source"),p=h[B].getAttribute("target"),u=h[B].getAttribute("id"),E=h[B].getAttribute("directed"),l=E!=null?!E:k,D=j.addEdge({source:q,target:p,bidirectional:l});A(D,"edge");v(h[B],D,"edge")}}},d=function(h){var g=jsPlumbToolkit.util.xml,f=g.createElement("graph");return g.xmlToString(f)};c.exporters={graphml:d,json:b};c.parsers={graphml:a,json:e};c.parse=function(f,i,h,g){var j=c.parsers[f];if(j===null){throw new Error(f+" is unsupported")}else{return j(i,h,g)}};c["export"]=function(f,g){var h=c.exporters[f];if(h===null){throw new Error(f+" is unsupported")}else{return h(g)}}})(jsPlumbToolkitIO);var jsPlumbLayout=(typeof module!=="undefined"&&module.exports)||{};(function(d){var e=d.AbstractLayout=function(i){i=i||{};var r=this,n=jsPlumb.CurrentLibrary,I=function(){return{padding:[0,0]}},G=function(){var U=jsPlumb.extend(I(),r.defaultParameters||{});jsPlumb.extend(U,O||{});O=U},O=i.parameters;r.animate=i.animate;r.adapter=i.adapter;r.requiresScaling=false;var P=i.draggable!==false,p=i.dragOptions||{},z=i.jsPlumb||jsPlumb,v=i.jsPlumbToolkit||jsPlumbToolkit,K=i.graph,w={},A={},Q=[],y={},F=n.getElementObject(i.container||window),m=n.getSize(F),D=n.getOffset(F),f=(i.width||m[0]),j=(i.height||m[1]),t=false;var L=function(){t=false;w={};A={};Q.splice(0);y={};r.reset&&r.reset()};r.setUserPosition=function(W,U,X){var V=w[W];if(!V){w[W]=[U,X]}else{V[0]=U;V[1]=X}A[W]=[U,X]};r.nodeRemoved=function(U){delete w[U];delete A[U];delete y[U];if(r._nodeRemoved){r._nodeRemoved(U)}};var o=function(V){var U=y[V];if(!U){U=n.getSize(n.getElementObject(V));y[V]=U}return U},M=function(X,U,W){var V=w[X];if(!V){if(U!=null&&W!=null){V=[U,W]}else{V=[Math.floor(Math.random()*(f+1)),Math.floor(Math.random()*(j+1))]}w[X]=V;Q.push([V,X])}return V},h=function(X,U,W){var V=w[X];if(!V){V=w[X]=[U,W];Q.push([V,X])}else{V[0]=U;V[1]=W}},x=function(X,U,V){var W=w[X];if(!W){W=w[X]=[]}W[0]=Math.floor(Math.random()*U);W[1]=Math.floor(Math.random()*V);return W},l=function(V){var U=A[V];if(!U){U=A[V]=[]}return U},B=function(X,V,W){var U=A[X];if(!U){U=A[X]=[V,W]}else{U[0]=V;U[1]=W}},u=function(){var X=ymin=Infinity,U=ymax=-Infinity;for(var V in w){var W=o(V);X=Math.min(X,w[V][0]);U=Math.max(U,w[V][0]);ymin=Math.min(ymin,w[V][1]);ymax=Math.max(ymax,w[V][1])}return[[X,ymin],[U,ymax],Math.abs(X-U),Math.abs(ymin-ymax)]},s=function(U){Q.sort(function(X,V){var Y=Math.sqrt(Math.pow(X[0][0]-U[0][0],2)+Math.pow(X[0][1]-U[0][1],2)),W=Math.sqrt(Math.pow(V[0][0]-U[0][0],2)+Math.pow(V[0][1]-U[0][1],2));X.push(Y);V.push(W);return Y<W?-1:Y>W?1:0})},H=function(W,V,X,U){return(W[V]<=U&&U<=W[V]+W[X])},T=[function(V,U){return V.x+V.w-U.x},function(V,U){return V.x-(U.x+U.w)}],C=[function(V,U){return V.y+V.h-U.y},function(V,U){return V.y-(U.y+U.h)}],g=[null,[T[0],C[1]],[T[0],C[0]],[T[1],C[0]],[T[1],C[1]]],E=function(W,V,X,ac,ae){if(isNaN(X)){X=0}var ab=V.y+V.h,ad=(X==Infinity||X==-Infinity)?V.x+(V.w/2):(ab-ac)/X,U=Math.atan(X);if(H(V,"x","w",ad)){var aa=g[ae][1](W,V),Z=aa/Math.sin(U),Y=Z*Math.cos(U);return{left:Y,top:aa}}else{var Y=g[ae][0](W,V),Z=Y/Math.cos(U),aa=Z*Math.sin(U);return{left:Y,top:aa}}},q=function(X,W){var aa=[X.x+(X.w/2),X.y+(X.h/2)],Y=[W.x+(W.w/2),W.y+(W.h/2)],V=jsPlumbUtil.gradient(aa,Y),Z=jsPlumbUtil.segment(aa,Y),U=(V==Infinity||V==-Infinity||isNaN(V))?0:aa[1]-(V*aa[0]);return E(X,W,V,U,Z)},J=function(){s(u());var aa=100,X=1,ae=true;while(ae&&X<aa){ae=false;for(var ac=0;ac<Q.length;ac++){var ad=jsPlumb.CurrentLibrary,Z=w[Q[ac][1]],ag=y[Q[ac][1]],Y={x:Z[0]-r.padding[0],y:Z[1]-r.padding[1],w:ag[0]+(2*r.padding[0]),h:ag[1]+(2*r.padding[1])};for(var ab=0;ab<Q.length;ab++){if(ac!=ab){var W=w[Q[ab][1]],af=y[Q[ab][1]],V={x:W[0]-r.padding[0],y:W[1]-r.padding[1],w:af[0]+(2*r.padding[0]),h:af[1]+(2*r.padding[1])};if(jsPlumbUtil.intersects(Y,V)){ae=true;var U=q(Y,V);W[0]+=(U.left+1);W[1]+=(U.top+1)}}}}X++}},k=function(){for(var U in w){console.log(U,w[U][0],w[U][1])}},R=function(){var aa=u(),ac=((f-aa[2])/2)-aa[0][0],ab=((j-aa[3])/2)-aa[0][1],X=function(af){if(!r.requiresScaling){return{left:af[0],top:af[1]}}else{var ae=((af[0]-aa[0][0])/aa[2])+0.05,ad=((af[1]-aa[0][1])/aa[3])+0.05;return{left:ae*f*0.9,top:ad*j*0.9}}};for(var Z in w){var W=n.getElementObject(Z),U=w[Z],Y=A[Z],V=Y&&Y[0]!=null&&Y[1]!=null?{left:Y[0],top:Y[1]}:X(U);r.adapter.setOffset(W,V)}},S=function(V){console.log(V);var U=u();k();console.log(U[0],U[1],U[2],U[3])};r.bb=S;r.begin=function(){};r.end=function(){};var N=function(){G();r.begin&&r.begin(K,v,O);while(!t){r.step(K,v,O)}if(r.doMagnetize){J()}R();r.end&&r.end(K,v,O)};r.relayout=function(U){L();if(U!=null){O=U}N()};r.layout=function(){t=false;N()};r.clear=function(){L()};return{jsPlumb:z,toolkit:v,graph:K,getPosition:M,setPosition:h,getRandomPosition:x,getSize:o,getUserPosition:l,setUserPosition:B,calculateSpacingAdjustment:q,width:f,height:j,setDone:function(U){t=U}}};var b=function(h){var f=this,g=e.apply(this,arguments);return g};var c=function(h){h=h||{};var g=e.apply(this,arguments),f=this;f.begin=function(q,o,r){var n=q.getVertexCount(),s=r.locationFunction||function(i){return[i.data.left,i.data.top]};for(var m=0;m<n;m++){var p=q.getVertexAt(m),j=o.getNodeId(p.data),k=s(p);g.setPosition(j,k[0],k[1]);g.setUserPosition(j,k[0],k[1])}};f.step=function(){g.setDone(true)};return g};var a=function(h){var f=this,g=jsPlumbLayout.AbstractLayout.apply(this,arguments);f.begin=function(k,j,i){i.ignoreLoops=!(h.ignoreLoops===false);if(!i.root){if(k.getVertexCount()>0){i.rootNode=k.getVertexAt(0);i.root=i.rootNode.id}else{g.setDone(true)}}else{i.rootNode=k.getVertex(i.root)}};return g};d.Layouts={Magnetized:function(i){var f=this,h=jsPlumbLayout.AbstractLayout.apply(this,arguments),g=i.reverse;f.doMagnetize=true;f.step=function(n,m){var j=n.getVertexCount(),l=function(o){var p=n.getVertexAt(o),q=p.id,r=h.getPosition(q)};if(g){for(var k=j-1;k>-1;k--){l(k)}}else{for(var k=0;k<j;k++){l(k)}}h.setDone(true)}},Balloon:function(l){l=l||{};var p=this,o=a.apply(this,arguments),k={},j={},h=0,g=0,m=jsPlumb.CurrentLibrary,n=o.toolkit.getNodeId,i=function(s,q,w,r,v,u){var t={node:s,id:s.id,size:r,pos:o.getPosition(s.id,q,w),depth:v,angle:u,children:[]};jsPlumbUtil.addToList(k,v,t);return t};var f=function(I,F,H,z){if(j[I.node.id]){if(!o.ignoreLoops){throw"Circular loop: cannot layout hierarchy"}else{return}}j[I.node.id]=true;var t=I.node.getAllEdges(),B=2*Math.PI/t.length,E=o.getSize(I.node.id),r={x:I.pos[0]-(E[0]/2)-z.padding,y:I.pos[1]-(E[1]/2)-z.padding,w:E[0]+(z.padding*2),h:E[1]+(z.padding*2)},x=r.x,v=r.y,w=x+r.w,u=v+r.h;H+=B;var A=0,y=0;for(var G=0;G<t.length;G++){if(I.node==t[G].source){var N=o.graph.getVertex(t[G].target),M=I.pos[0]+(Math.cos(H)*F),K=I.pos[1]+(Math.sin(H)*F),C=o.getSize(N.id);I.children.push(i(N,M,K,C,I.depth+1,H));H+=B}}for(var G=0;G<I.children.length;G++){f(I.children[G],F,I.children[G].angle+Math.PI,z);var J=I.children[G].children.length>0?z.padding*4:z.padding,D={x:I.children[G].pos[0]-(I.children[G].size[0]/2)-J,y:I.children[G].pos[1]-(I.children[G].size[1]/2)-J,w:I.children[G].size[0]+(2*J),h:I.children[G].size[1]+(2*J)},q=function(O,P){O.pos[0]+=P.left;O.pos[1]+=P.top;if(O.children){for(var s=0;s<O.children.length;s++){q(O.children[s],P)}}};if(jsPlumbUtil.intersects(r,D)){var L=o.calculateSpacingAdjustment(r,D);q(I.children[G],L)}}};p.defaultParameters={padding:30};p.step=function(t,s,r){var q=o.getSize(r.root),u=i(r.rootNode,h,g,q,0);u.root=true;f(u,1,-(Math.PI/2),r);o.setDone(true)};p.reset=function(){k={};j={};h=0;g=0}},Hierarchical:function(A){var r=this,z=a.apply(this,arguments),j,m,o,p,w,q,h=jsPlumb.CurrentLibrary,k=[],l=[],y=[],i=z.toolkit.getNodeId,f=function(C){var B=l[C];if(!B){B={nodes:[],pointer:0};l[C]=B}return B},v=function(H,B,I,G,E){var F=f(I),D={node:H,parent:G,childGroup:E,loc:F.pointer,index:F.nodes.length,dimensions:B,size:B[o]};var C=B[o==0?1:0];if(k[I]==null){k[I]=C}else{Math.max(k[I],C)}F.pointer+=(B[o]+q[o]);F.nodes.push(D);return D},t=function(B,C){var D=y[C];if(!D){D=[];y[C]=D}B.index=D.length;D.push(B)},n=function(B){if(B.size>0){var E=(B.parent.loc+(B.parent.size/2))-((B.size-q[o])/2);var D=y[B.depth],C=-Infinity,H=0;if(D!=null&&D.length>0){var J=D[D.length-1],I=J.nodes[J.nodes.length-1];C=I.loc+I.size+q[o]}if(E>=C){B.loc=E}else{H=C-E;B.loc=C}var F=B.loc;for(var G=0;G<B.nodes.length;G++){B.nodes[G].loc=F;F+=B.nodes[G].size;F+=q[o]}if(H>0){u(B)}t(B,B.depth)}},s=function(H){var E=H.nodes[0].loc,B=H.nodes[H.nodes.length-1].loc+H.nodes[H.nodes.length-1].size,I=(E+B)/2,G=I-(H.parent.size/2),F=G-H.parent.loc;H.parent.loc=G;if(!H.parent.root){var D=H.parent.childGroup;for(var C=H.parent.childGroupIndex+1;C<D.nodes.length;C++){D.nodes[C].loc+=F}}},u=function(C){var B=C;while(B!=null){s(B);B=B.parent.childGroup}},x=function(E,C){var F=E.node.getAllEdges(i(E.node)),H={nodes:[],loc:0,size:0,parent:E,depth:C+1},D=[];for(var G=0;G<F.length;G++){if(F[G].source==E.node){var B=z.graph.getVertex(F[G].target),J=z.getSize(i(B)),I=v(B,J,C+1,E,H);I.childGroupIndex=H.nodes.length;H.nodes.push(I);H.size+=(J[o]+q[o]);D.push(I)}}n(H);for(var G=0;G<D.length;G++){x(D[G],C+1)}};r.defaultParameters={padding:[20,20],orientation:"horizontal"};var g=r.begin;r.begin=function(D,C,B){g.apply(this,arguments);j=B.orientation;m=(j==="horizontal");o=m?0:1;p=m?"width":"height";w=D.getVertexCount();q=B.padding};r.step=function(J,I,K){var C=z.getSize(K.root),B=v(K.rootNode,C,0,null,null);B.root=true;x(B,0,null);var D=0;for(var F=0;F<l.length;F++){for(var E=0;E<l[F].nodes.length;E++){var H=o==0?l[F].nodes[E].loc:D;var G=o==1?l[F].nodes[E].loc:D;z.setPosition(i(l[F].nodes[E].node),H,G)}D+=(k[F]+q[o==0?1:0])}z.setDone(true)}},Circular:function(h){var f=this;h=h||{};var g=e.apply(this,arguments);f.defaultParameters={padding:30};f.step=function(m,p,r){var H=m.getVertexCount(),w=0,u=0,J=0,C=0,q=10,z=2*Math.PI/H,I=-Math.PI/2;for(var F=0;F<H;F++){var D=m.getVertexAt(F);g.setPosition(D.id,w+(Math.sin(I)*q),u+(Math.cos(I)*q));I+=z}var t=m.getVertexAt(0),o=g.getSize(t.id),l=g.getPosition(t.id),G={x:l[0]-r.padding,y:l[1]-r.padding,w:o[0]+(2*r.padding),h:o[1]+(2*r.padding)},s=m.getVertexAt(1),k=g.getSize(s.id),j=g.getPosition(s.id),E={x:j[0]-r.padding,y:j[1]-r.padding,w:k[0]+(2*r.padding),h:k[1]+(2*r.padding)},v=g.calculateSpacingAdjustment(G,E);var B=[l[0]+(o[0]/2),l[1]+(o[1]/2)],A=[j[0]+v.left+(k[0]/2),j[1]+v.top+ +(k[1]/2)],K=Math.sqrt(Math.pow(B[0]-A[0],2)+Math.pow(B[1]-A[1],2));q=(K/2)/Math.sin(z/2);for(var F=0;F<H;F++){var D=m.getVertexAt(F);g.setPosition(D.id,w+(Math.sin(I)*q),u+(Math.cos(I)*q));I+=z}g.setDone(true)}},Absolute:function(f){c.apply(this,arguments)},Spring:function(v){var n=this,t=c.apply(this,arguments);n.requiresScaling=true;n.defaultParameters={stiffness:200,repulsion:200,limit:10000,damping:0.5};var x=n.defaultParameters;var k={},s=100,i=100,r=function(B){return Math.sqrt(Math.pow(B[0],2)+Math.pow(B[1],2))},w=function(B,C){return[(B[0]/C)||0,(B[1]/C)||0]},o=function(B,C){return[B[0]*C,B[1]*C]},q=function(C,B){return[C[0]+B[0],C[1]+B[1]]},A=function(C,B){return[C[0]-B[0],C[1]-B[1]]},m=function(B){return B.s[0]*B.s[1]},g=function(B){if("CENTER"==B){return{v:[0,0],p:[s/2,i/2],a:[0,0],m:100}}if(B.getNode){B=B.getNode()}var C=k[B.id];if(!C){C=k[B.id]={v:[0,0],p:t.getRandomPosition(B.id,s,i),a:[0,0],m:1,s:t.getSize(B.id)}}return C},p=function(B){return w(B,r(B))},h=function(C,B){C.a=q(C.a,w(B,C.m))},u=function(D,F){var J=g(D),I=g(F);if(J.p!=I.p){var C=[J.p[0]-I.p[0],J.p[1]-I.p[1]],K=r(C)+0.1,E=p(C),H=o(E,x.repulsion),G=w(H,K*K*0.5),B=w(H,K*K*-0.5);h(J,G);h(I,B)}},z=function(D,C){var H=g(D),G=g(C.target),I=A(G.p,H.p),J=1-r(I),E=p(I),F=o(E,x.stiffness*J*-0.5),B=o(E,x.stiffness*J*0.5);h(H,F);h(G,B)},l=function(C){var D=g(C),B=o(D.p,-1);h(D,o(B,x.repulsion/50))},f=function(C,B){var E=g(C),D=o(q(E.v,o(E.a,B)),x.damping);E.v=D;E.a=[0,0]},j=function(C,B){var E=g(C),D=q(E.p,o(E.v,B));E.p[0]=D[0];E.p[1]=D[1]},y=function(G){var C=0;for(var D=0;D<G;D++){var F=t.graph.getVertexAt(D),H=g(F),E=r(H.v),B=m(H);C+=0.5*B*E*E}return C};n.map=function(C,D,B,F,E){};n.reset=function(){k={}};n._nodeRemoved=function(B){delete k[B]};n.step=function(I,H,J){var F=I.getVertexCount();x=J;for(var E=0;E<F;E++){var G=I.getVertexAt(E),D=G.getAllEdges();for(var C=0;C<F;C++){if(E!=C){u(G,I.getVertexAt(C))}}for(var B=0;B<D.length;B++){z(G,D[B])}z(G,{target:"CENTER"});l(G);f(G,0.03);j(G,0.03)}if(y(F)<x.limit){t.setDone(true)}}},ForceDirected:function(y){var o=this,x=c.apply(this,arguments),u=0,l={},k=y.repulsion||1000,m=y.attraction||0.1,w=5,j=y.damping||0.5,r=y.springLength||100,h=0,p=150,t=100,i=100,s=function(A,z){var C=A.m*Math.cos((Math.PI/180)*A.b);var B=A.m*Math.sin((Math.PI/180)*A.b);var G=z.m*Math.cos((Math.PI/180)*z.b);var E=z.m*Math.sin((Math.PI/180)*z.b);C+=G;B+=E;var D=Math.sqrt(Math.pow(C,2)+Math.pow(B,2));var F=(D==0)?0:(180/Math.PI)*Math.atan2(B,C);return new f(D,F)},f=function(A,z){this.m=A;this.b=z;this.multiply=function(B){this.m*=B;return this};this.toPoint=function(){var C=this.m*Math.cos((Math.PI/180)*this.b),B=this.m*Math.sin((Math.PI/180)*this.b);return[C,B]}},g=function(z){if(z.getNode){z=z.getNode()}var A=l[z.id];if(!A){A=l[z.id]={v:new f(0,0),p:x.getRandomPosition(z.id,t,i),s:x.getSize(z.id)}}return A},n=function(A,z){return Math.sqrt(Math.pow(A[0]-z[0],2)+Math.pow(A[1]-z[1],2))},v=function(D,B){var C=g(D),A=g(B),F=n(C.p,A.p),E=k*Math.pow(F,2),z=jsPlumbUtil.theta(C.p,A.p);return new f(E,z)},q=function(D,B){var C=g(D),A=g(B),F=n(C.p,A.p),E=m*Math.max(F-r,0),z=jsPlumbUtil.theta(C.p,A.p);return new f(E,z)};o.requiresScaling=true;this.step=function(){u=0;var F=x.graph.getVertexCount();for(var D=0;D<F;D++){var G=x.graph.getVertexAt(D),H=g(G),C=G.getAllEdges(),E=new f(0,0),z=new f(n([0,0],H.p),jsPlumbUtil.theta([0,0],H.p));for(var B=0;B<F;B++){if(D!=B){E=s(E,v(G,x.graph.getVertexAt(B)))}}for(var A=0;A<C.length;A++){E=s(E,q(G,C[A].target))}H.v=s(H.v,E);H.v.multiply(j);H.next=s(z,H.v).toPoint()}for(var D=0;D<F;D++){var H=g(x.graph.getVertexAt(D));u+=n(H.p,H.next);H.p=H.next}if(u>w){x.setDone(true)}h++;if(h>=p){x.setDone(true)}};o.reset=function(){l={};h=0};o._nodeRemoved=function(z){delete l[z]}}}})(jsPlumbLayout);(function(b){b.version="0.1";b.name="jsPlumbToolkit";var e=jsPlumb.CurrentLibrary,a=function(g){return g.id},f=function(g){return g.type||"default"};var d=function(i,h){var g=this;this.fetch=function(){if(i.url){e.ajax({url:i.url,success:function(k){h.setGraph(g.process(k));if(i.success){i.success()}},error:function(k){if(i.error){i.error(k)}}})}else{if(i.data){try{h.setGraph(g.process(i.data));if(i.success){i.success(i.data)}}catch(j){if(i.error){i.error("cannot import: "+j)}}}else{if(i.error){i.error("no data specified")}}}}};var c=function(B){B=B||{};var w=B.idFunction||a,g=B.typeFunction||f,C=B.edgeIdFunction||w,u=B.edgeTypeFunction||g,q=B.portIdFunction||w,o=B.portTypeFunction||g,p=this,z=false,E=false,k=B.palette,j=function(t,F,G){F=jsPlumb.clone(F||{});F.id=F.id||jsPlumbToolkitUtil.uuid();F.type=t;G(F)},x=B.nodeFactory||j,h=B.edgeFactory||j,m=B.portFactory||j;this.getNodeFactory=function(){return x};this.getEdgeFactory=function(){return h};this.getPortFactory=function(){return m};this.setNodeFactory=function(t){x=t};this.setEdgeFactory=function(t){h=t};this.setPortFactory=function(t){m=t};this.setDebugEnabled=function(t){E=t};this.isDebugEnabled=function(){return E};this.getPalette=function(t){return k||{}};this.setSuspendGraph=function(t){z=t};jsPlumbUtil.EventGenerator.apply(this,arguments);this.getTypeFunction=function(){return g};this.connect=function(I){I=I||{};if(!z){var t=v.getVertex(I.source),F=v.getVertex(I.target),J=I.cost,H=I.directed;if(!t){if(!I.doNotCreateMissingNodes){t=v.addVertex(I.source);p.fire("nodeAdded",{data:{},node:t})}else{return}}if(!F){if(!I.doNotCreateMissingNodes){F=v.addVertex(I.target);p.fire("nodeAdded",{data:{},node:F})}else{return}}var G=v.addEdge({source:t,target:F,cost:J,directed:H});p.fire("edgeAdded",G)}};this.clear=function(){v.clear();p.fire("graphCleared");return p};var v=new jsPlumbGraph.Graph();this.getGraph=function(){return v};this.setGraph=function(t){v=t;p.fire("graphChanged",v)};this.getNodeCount=function(){return v.getVertexCount()};this.getNodeAt=function(t){return v.getVertexAt(t)};this.getEdgeCount=function(){return v.getEdgeCount()};this.layout=function(G,t){if(!jsPlumbLayout.Layouts[G.type]){throw"no such layout ["+G.type+"]"}var F=jsPlumb.extend({},G);F.graph=v;F.jsPlumbToolkit=p;F.adapter=t;return new jsPlumbLayout.Layouts[G.type](F)};this.getNodeId=function(t){return jsPlumbUtil.isObject(t)?w(t):t};this.getNodeType=function(t){return g(t)||"default"};this.getEdgeId=function(t){return jsPlumbUtil.isObject(t)?C(t):t};this.getEdgeType=function(t){return u(t)||"default"};this.getPortId=function(t){return jsPlumbUtil.isObject(t)?q(t):t};this.getPortType=function(t){return o(t)||"default"};this.addNode=function(F){if(w(F)==null){F.id=jsPlumbToolkitUtil.uuid()}var t=v.addNode(F,w);p.fire("nodeAdded",{data:F,node:t});return t};this.addNodes=function(t){for(var F=0;F<t.length;F++){p.addNode.apply(p,[t[F]])}};this.getNode=function(t){return v.getVertex(t)};this.removeNode=function(H,G){H=(H.constructor==jsPlumbGraph.Vertex||H.constructor==jsPlumbGraph.Port)?H:v.getVertex(H);var t=H.getAllEdges()||[];for(var F=0;F<t.length;F++){p.removeEdge(t[F])}v.deleteVertex(H.id);if(!G){p.fire("nodeRemoved",{node:H,nodeId:H.id,edges:t})}};this.addEdge=function(I,F){var H=jsPlumbUtil.isObject(I.source)?p.getNodeId(I.source):I.source,t=jsPlumbUtil.isObject(I.target)?p.getNodeId(I.target):I.target,G=v.addEdge({source:H,target:t,data:I.data,cost:I.cost,directed:I.directed});if(!F){p.fire("edgeAdded",G,null)}return G};this.removeEdge=function(F,t){if(F!=null){v.deleteEdge(F);if(!t){p.fire("edgeRemoved",F,null)}}};this.addNewPort=function(H,G,t,F){var H=v.getVertex(H);m({node:H,type:G},t,function(K){var J=q(K),I=H.addPort(J);I.data=K;if(!F){p.fire("portAdded",{node:H,data:K,port:I},null)}})};this.addPort=function(F,G,t){var H=F.addPort(G,q);if(t){p.fire("portAdded",{node:F,data:G,port:H},null)}return H};this.removePort=function(J,H,I){var K=false;J=(J.constructor==jsPlumbGraph.Vertex||J.constructor==jsPlumbGraph.Port)?J:v.getVertex(J);var F=J.getPort(H);if(F){var t=F.getAllEdges();K=J.removePort(F);if(K&&!I){p.fire("portRemoved",{node:J,port:F,edges:t},null);for(var G=0;G<t.length;G++){p.removeEdge(t[G])}}}return K};var i=function(t){return v.findPath(t.source,t.target)};this.getPath=function(J){var I=i(J),H={},F=function(){for(var K=0;K<I.path.length;K++){if(I.path[K].edge){p.removeEdge(I.path[K].edge)}}return H},t=function(){for(var K=0;K<I.path.length;K++){p.removeNode(I.path[K].vertex)}return H},G=function(M){var K=l(M),N=false;if(K){for(var L=0;L<I.path.length;L++){if(I.path[L].vertex==K||I.path[L].edge==K){N=true;break}}}return N};H.getNodeCount=function(){return I.path.length};H.getEdgeCount=function(){return I.path.length==0?0:I.path.length-1};H.path=I;H.deleteEdges=F;H.deleteNodes=t;H.deleteAll=t;H.isEmpty=function(){return I.path.length==0};H.getCost=function(){return I.pathDistance};H.contains=G;return H};var l=function(t){if(t==null){return null}else{if(jsPlumbUtil.isString(t)){return v.getVertex(t)}else{if(t.constructor==jsPlumbGraph.Vertex||t.constructor==jsPlumbGraph.Port){return t}}}return null};var A=function(J,G,F){var t=[],I={},H=function(K){if(!I[K.getId()]){t.push(K);I[K.getId()]=true}};_addEdges=function(Q,P,R,K){if(Q!=null){var O=Q[G]();for(var M=0;M<O.length;M++){var L=(O[M].source==Q||(F&&O[M].source.constructor==jsPlumbGraph.Port&&O[M].source.getNode()==Q)),N=(O[M].target==Q||(F&&O[M].target.constructor==jsPlumbGraph.Port&&O[M].target.getNode()==Q));if((P&&L)||(R&&N)||(K&&(L||N))){H(O[M])}}}};_addEdges(l(J.source),true,false,false);_addEdges(l(J.target),true,false,false);_addEdges(l(J.element),false,false,true);return t};this.selectEdges=function(t){return A(t,"getEdges",false)};this.selectAllEdges=function(t){return A(t,"getAllEdges",true)};this.load=function(F){var J=F.type||"json",I=F.data,t=F.url,K=F.jsonp,H=F.onload,L=F.parameters||{};var G=function(N){p.fire("dataLoadStart");jsPlumbToolkitIO.parse(J,N,p,L);D();if(H){H(p,N)}p.fire("graphChanged")};if(I){G(I)}else{if(t){if(K){var M=t.indexOf("?")===-1?"?":"&";t=t+M+"callback=?"}if(J==="json"){$.getJSON(t,function(N){G(N)})}else{$.get(t,function(N){G(N)})}}}return p};var n={},y={};var D=function(){p.setSuspendGraph(true);p.fire("dataLoadEnd");p.setSuspendGraph(false)};this.render=function(F){var t=s(F);t.initialize();return t};var s=function(H){H=H||{};var G=jsPlumb.extend({toolkit:p},H),t=G.type||jsPlumbToolkit.DefaultRendererType,F=new jsPlumbToolkit.Renderers[t](G);return F};if(B.data){var r=B.dataType||"json";p.load({data:B.data,type:r})}};window.jsPlumbToolkit=new c({});jsPlumbToolkit.DefaultRendererType=null;jsPlumbToolkit.ready=jsPlumb.ready;jsPlumbToolkit.newInstance=function(g){return new c(g)};jsPlumbToolkit.Renderers={};jsPlumbToolkit.util={Cookies:{get:function(g){var h=document.cookie.match((new RegExp(g+"=[a-zA-Z0-9.()=|%/_]+($|;)","g")));if(!val||val.length==0){return null}else{return unescape(val[0].substring(g.length+1,val[0].length).replace(";",""))||null}},set:function(i,j,k,g){var l=[i+"="+escape(j),"path="+(!k)?"/":k,"domain="+(!domain)?window.location.host:domain],h=function(){if(parseInt(g)=="NaN"){return""}else{var m=new Date();m.setTime(m.getTime()+(parseInt(g)*60*60*1000));return m.toGMTString()}};if(g){l.push(h(g))}return document.cookie=l.join("; ")},unset:function(g,i,h){i=(!i||typeof i!="string")?"":i;h=(!h||typeof h!="string")?"":h;if(jsPlumbToolkit.util.Cookies.get(g)){jsPlumbToolkit.util.Cookies.set(g,"","Thu, 01-Jan-70 00:00:01 GMT",i,h)}}},Storage:{set:function(g,h){if(typeof localStorage=="undefined"){jsPlumbToolkit.util.Cookies.set(g,h)}else{localStorage.setItem(g,h)}},get:function(g){return(typeof localStorage=="undefined")?jsPlumbToolkit.util.Cookies.read(g):localStorage.getItem(g)},clear:function(g){if(typeof localStorage=="undefined"){jsPlumbToolkit.util.Cookies.unset(g)}else{localStorage.removeItem(g)}},clearAll:function(){if(typeof localStorage=="undefined"){alert("HOW DO I UNSET ALL COOKIES?")}else{while(localStorage.length>0){var g=localStorage.key(0);localStorage.removeItem(g)}}}}}})({});(function(){jsPlumbToolkit.Palette=function(A,v){A=A||{};A.nodes=A.nodes||{};A.edges=A.edges||{};A.ports=A.ports||{};var u=function(B){var C=jsPlumbToolkitUtil.mergeWithParents(B,A.nodes);delete C.parent;return C},z=function(B){var C=jsPlumbToolkitUtil.mergeWithParents(B,A.edges);delete C.parent;return C},y=function(C,B){var D=B&&B.ports?jsPlumbToolkitUtil.mergeWithParents(C,B.ports):jsPlumbToolkitUtil.mergeWithParents(C,A.ports);delete D.parent;return D};for(var w in A.edges){var x=z(w);v.registerConnectionType(w,x)}for(var w in A.ports){var x=y(w);v.registerEndpointType(w,x)}return{getNodeDefinition:u,getEdgeDefinition:z,getPortDefinition:y}};var d=jsPlumb.CurrentLibrary;var c=function(D){var E=this,y=["-moz-transform","-webkit-transform","-o-transform","transform","-ms-transform"],v=jsPlumbToolkitUtil.getInternetExplorerVersion(),u=v>0&&v<9,z=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,B=new RegExp("^("+z+")(?!px)[a-z%]+$","i"),A=/^(top|right|bottom|left)$/,w=function(L){var J="fontSize",N,H,G,M=L.currentStyle,I=M?M[J]:undefined,K=L.style;if(I==null&&K&&K[J]){I=K[J]}if(B.test(I)&&!A.test(J)){N=K.left;H=L.runtimeStyle;G=H&&H.left;if(G){H.left=L.currentStyle.left}K.left=J==="fontSize"?"1em":I;I=K.pixelLeft+"px";K.left=N;if(G){H.left=G}}return I===""?"auto":I},C,F,x=function(G){return((G*E.curZoom)/F).toFixed(8)+"em"};if(u){C=w(D);F=C.substring(0,C.length-2)}E.curZoom=1;this.zoom=function(I){if(!u){var H="scale("+I+")";for(var G=0;G<y.length;G++){D.style[y[G]]=H}}else{D.style.fontSize=(I*100)+"%"}E.curZoom=I};this.dragStop=function(H){if(u){var G=H.style.left,K=H.style.top,J=G.substring(0,G.length-2),M=K.substring(0,K.length-2),I=x(J),L=x(M);H.style.left=I;H.style.top=L}}};var o={NODE:"data-jtk-node-id",PORT:"data-jtk-port-id"},r={MINIVIEW_CANVAS:"jtk-miniview-canvas",MINIVIEW_PAN:"jtk-miniview-pan",MINIVIEW_ELEMENT:"jtk-miniview-element",NODE:"jtk-node",NODE_PALETTE:"jtk-node-palette",NODE_PALETTE_ENTRY:"jtk-node-palette-entry",PORT:"jtk-port",SURFACE:"jtk-surface",SURFACE_CANVAS:"jtk-surface-canvas",SURFACE_LASSO:"jtk-surface-lasso",SURFACE_PAN:"jtk-surface-pan",SURFACE_PAN_LEFT:"jtk-surface-pan-left",SURFACE_PAN_TOP:"jtk-surface-pan-top",SURFACE_PAN_RIGHT:"jtk-surface-pan-right",SURFACE_PAN_BOTTOM:"jtk-surface-pan-bottom",SURFACE_PAN_ACTIVE:"jtk-surface-pan-active",SURFACE_SELECTED_ELEMENT:"jtk-surface-selected-element",TOOLBAR:"jtk-toolbar",TOOLBAR_TOOL:"jtk-tool",TOOLBAR_TOOL_SELECTED:"jtk-tool-selected",TOOLBAR_TOOL_ICON:"jtk-tool-icon"},t={left:"left",right:"right",top:"top",bottom:"bottom",width:"width",height:"height",leftmin:"leftmin",leftmax:"leftmax",topmin:"topmin",topmax:"topmax",min:"min",max:"max",px:"px",onepx:"1px",nopx:"0px",em:"em",absolute:"absolute",relative:"relative",none:"none",block:"block",hidden:"hidden",div:"div",id:"id",plusEquals:"+=",minusEquals:"-=",dot:".",transform:"transform",transformOrigin:"transform-origin",div:"div"},b={anchorChanged:"anchorChanged",canvasClick:"canvasClick",click:"click",connection:"connection",connectionDetached:"connectionDetached",contentDimensions:"contentDimensions",contextmenu:"contextmenu",dataLoadStart:"dataLoadStart",dataLoadEnd:"dataLoadEnd",drag:"drag",edgeAdded:"edgeAdded",edgeRemoved:"edgeRemoved",elementDragged:"elementDragged",elementAdded:"elementAdded",elementRemoved:"elementRemoved",graphCleared:"graphCleared",modeChanged:"modeChanged",mousedown:"mousedown",mousemove:"mousemove",mouseout:"mouseout",mouseup:"mouseup",nodeAdded:"nodeAdded",nodeMoveStart:"nodeMoveStart",nodeMoveEnd:"nodeMoveEnd",nodeRemoved:"nodeRemoved",objectRepainted:"objectRepainted",pan:"pan",portAdded:"portAdded",portRemoved:"portRemoved",start:"start",stop:"stop",touchend:"touchend",touchmove:"touchmove",touchstart:"touchstart",unload:"unload"},s=r,f=t,e=b,m=function(u){console.log(u)},j=function(v,F){var u=function(w){return w.substring(0,w.length-2)},C=parseInt(u(v.style.left)),B=parseInt(u(v.style.top)),D=parseInt(u(v.style.width)),z=parseInt(u(v.style.height)),E=C+((1-F)*D/2),A=B+((1-F)*z/2);return{left:C,top:B}},h=function(u){var v=function(w){return parseInt(w.substring(0,w.length-2))||0};return{left:v(u.style.left),top:v(u.style.top)}},k=function(v,x,w,z,u,y){z=z||1;v.style.left=(u||0)+(z*x)+f.px;v.style.top=(y||0)+(z*w)+f.px},q=function(x,v){var w=document.createElement(x.type||f.div),u=x.units||f.px;if(x.top!=null){w.style.top=x.top+f.px}if(x.left!=null){w.style.left=x.left+f.px}if(x.right!=null){w.style.right=x.right+f.px}if(x.bottom!=null){w.style.bottom=x.bottom+f.px}w.style.width=x.width;w.style.height=x.height;w.style.position=x.position||f.absolute;if(x.id){w.setAttribute(f.id,x.id)}if(x.display){w.style.display=x.display}if(x.clazz){w.className=x.clazz}d.appendElement(w,v);return w};jsPlumb.ready(function(){var x=document.getElementById("jsPlumbToolkitTemplates");if(!x){x=document.createElement(f.div);x.style.display=f.none;x.id="jsPlumbToolkitTemplates";document.body.appendChild(x);var u=document.getElementsByTagName("script");for(var v=0;v<u.length;v++){var w=u[v].getAttribute("type"),y=u[v].getAttribute("src");if(w=="text/x-jsplumb-palette"){d.ajax({url:y,success:function(z){var A=x.innerHTML;A+=z;x.innerHTML=A},error:function(z){m("jsPlumbToolkit: cannot load palette from "+y)}})}}}});var p=function(u,w){var v=document.createElement("div");v.innerHTML=u.name||u.id;v.className=s.NODE;v.style.border="1px solid #456";v.style.position="absolute";v.setAttribute("id",w);return v},g={jquery:{render:function(v,w,x){var u=$("#"+v+"-"+x);if(!u||u.length==0){u=$("#"+v)}if(!u){throw new Error("Cannot resolve template "+v)}else{return u.tmpl(w)[0]}}},icanhaz:{render:function(u,v,w){return ich[u](v)}},underscore:{render:function(v,w,y){var u=_.template(document.getElementById(v).innerHTML)(w),x=document.createElement("div");x.innerHTML=jsPlumbToolkitUtil.fastTrim(u);var z=x.firstChild;return z}},handlebars:{render:function(u,x,z){var w=document.getElementById(u).innerHTML,v=Handlebars.compile(w),y=document.createElement("div");y.innerHTML=jsPlumbToolkitUtil.fastTrim(v(x));var A=y.firstChild;return A}},mustache:{render:function(u,x,z){var w=document.getElementById(u).innerHTML,v=Mustache.compile(w),y=document.createElement("div");y.innerHTML=jsPlumbToolkitUtil.fastTrim(v(x));var A=y.firstChild;return A}}},a="jquery";var n=function(x){var w=jsPlumb.CurrentLibrary,y=w.getElementObject(x.container),v=w.getDOMElement(x.container),u=v==window?{left:0,top:0}:w.getOffset(y);this.getWidth=function(){return w.getSize(y)[0]};this.getHeight=function(){return w.getSize(y)[1]};this.append=function(A){var z=w.getElementObject(A);w.appendElement(z,y)};this.remove=function(A){var z=w.getElementObject(A);w.removeElement(z)};this.setOffset=function(A,B){var z=w.getElementObject(A);w.setOffset(z,{left:u.left+B.left,top:u.top+B.top})};this.getOffset=function(A){var z=w.getElementObject(A);return w.getOffset(z)};this.getContainerOffset=function(){return w.getOffset(w.getElementObject(x.container))}};var l=function(){this.refresh=this.relayout=this.nodeRemoved=this.nodeAdded=this.setUserPosition=function(){}};var i=function(u){u=u||{};var C=this,w=u.toolkit,ad=new l(),x=jsPlumb.CurrentLibrary,R=x.getElementObject(u.container),T=x.getDOMElement(R),ah=!(u.draggable===false),A=u.dragOptions||{},H=false,D={},O={},ac={},M=u.idFunction||function(an){return w.getNodeId(an)},Z=u.typeFunction||function(an){return w.getNodeType(an)},X=u.edgeIdFunction||function(an){return w.getEdgeId(an)},ak=u.edgeTypeFunction||function(an){return w.getEdgeType(an)},am=u.portIdFunction||function(an){return w.getPortId(an)},aa=u.portTypeFunction||function(an){return w.getPortType(an)},L=u.templateRenderer?jsPlumbUtil.isString(u.templateRenderer)?g[u.templateRenderer]:{render:u.templateRenderer}:g[a];var ab=jsPlumbUtil.merge(u.jsPlumb||{},{Container:$(".jtk-surface-canvas")}),I=jsPlumb.getInstance(ab),al=I.getId(R);jsPlumbUtil.EventGenerator.apply(this,arguments);C.getJsPlumb=function(){return I};var E=[e.canvasClick,e.nodeAdded,e.nodeRemoved,e.nodeMoveStart,e.nodeMoveEnd,e.portAdded,e.portRemoved,e.edgeAdded,e.edgeRemoved,e.dataLoadEnd,e.anchorChanged,e.objectRepainted,e.pan],y=C.bind,z=I.bind;C.bind=function(an,ao){if(jsPlumbUtil.indexOf(E,an)==-1){z(an,ao)}else{y(an,ao)}};var P=false;z(e.connection,function(ap){P=true;var ao=ap.sourceEndpoint.getParameter("portType"),az=ag.getPortDefinition(ao),aA=az!=null&&az.edgeType?az.edgeType:"default",au=ag.getEdgeDefinition(aA),at=ap.sourceEndpoint.getParameter("nodeId"),av=ap.sourceEndpoint.getParameter("portId"),aw=ap.targetEndpoint.getParameter("nodeId"),an=ap.targetEndpoint.getParameter("portId"),ay=at+(av?"."+av:""),ax=aw+(an?"."+an:""),aq={sourceNodeId:at,sourcePortId:av,targetNodeId:aw,targetPortId:an,type:aA,source:w.getNode(ay),target:w.getNode(ax),sourceId:ay,targetId:ax};var ar=w.getEdgeFactory()(aq,{},function(aB){aq.edge=w.addEdge({source:ay,target:ax,cost:ap.connection.getCost(),directed:ap.connection.isDirected(),data:aB,addedByMouse:true},C);ae[aq.edge.getId()]=ap.connection;ap.connection.setParameter("edge",aq.edge);U(aA,aq.edge,ap.connection);C.fire(e.edgeAdded,aq)});if(ar===false){I.detach(ap.connection)}P=false});z(e.connectionDetached,function(aq){P=true;w.removeEdge(aq.connection.edge);P=false;var ap=aq.sourceEndpoint.getParameters(),ar=aq.targetEndpoint.getParameters(),ao=ap.nodeId+(ap.portId?"."+ap.portId:""),an=ar.nodeId+(ar.portId?"."+ar.portId:"");C.fire(e.edgeRemoved,{sourceNodeId:ap.nodeId,targetNodeId:ar.nodeId,sourcePortId:ap.portId,targetPortId:ar.portId,sourceId:ao,targetId:an,source:w.getNode(ao),target:w.getNode(an),edge:aq.connection.getParameter("edge")})});w.bind(e.dataLoadStart,function(){I.setSuspendDrawing(true);H=true});w.bind(e.dataLoadEnd,function(){H=false;if(ad){ad.relayout()}I.setSuspendDrawing(false,true);if(ad){C.fire(e.dataLoadEnd)}});var ai={},F={};w.bind(e.nodeAdded,function(ar){var aq=ag.getNodeDefinition(Z(ar.data));if(aq&&aq.ports){for(var ao in aq.ports){ar.node.addPort({id:ao})}}var ap=x.getDOMElement(ar.node.id);if(ap==null){ap=V(ar.node,ar.data,ar.node);if(!ap){throw new Error("Cannot render node")}C.append(ap)}else{ap.jtk={node:ar.node}}aj(x.getDOMElement(ap),ar.node,ar.node.id);ai[ar.node.id]=ap;var at=I.getSelector(ap,"[data-port-id]");for(var ao=0;ao<at.length;ao++){var an=at[ao].getAttribute("data-port-id");F[ar.node.id+"."+an]=at[ao];at[ao].jtk=at[ao].jtk||{node:ar.node,port:ar.node.getPort(an)}}C.fire(e.nodeAdded,{node:ar.node,data:ar.data,el:ap});C.refresh();return ap});w.bind(e.nodeRemoved,function(ao){var an=M(ao.node.data);C.getLayout().nodeRemoved(an);C.fire(e.nodeRemoved,{node:ao.node});I.setSuspendEvents(true);I.remove(an);I.setSuspendEvents(false);delete ai[ao.nodeId];C.refresh()});var ae={},Y=function(an){return ae[an.getId()]},Q=function(an){var ap=[];for(var ao=0;ao<an.length;ao++){ap.push(ae[an[ao].getId()])}return ap},af=function(aq,ap,ao,an){an.bind(aq,function(au,ar){var at=[ar,ao,an];at.push.apply(at,arguments);ap.apply(ap,at)})},U=function(aq,ar,ao){if(ao.getParameter("edge")){return}var an=ag.getEdgeDefinition(aq);if(an&&an.events){for(var ap in an.events){af(ap,an.events[ap],ar,ao)}}};w.bind(e.edgeAdded,function(ap){if(!P){var an=J(ap);an.doNotFireConnectionEvent=true;if(w.isDebugEnabled()){console.log("Renderer","adding edge with params",an)}var ao=I.connect(an);ao.edge=ap;ae[ap.getId()]=ao;U(an.type,ap,ao);C.fire(e.edgeAdded,{source:ap.source,target:ap.target,connection:ao,edge:ap})}});w.bind(e.edgeRemoved,function(ao){if(!P){var an=ae[ao.getId()];if(an){if(w.isDebugEnabled()){console.log("Renderer","removing edge",ao)}I.detach({connection:ae[ao.getId()],fireEvent:false});delete ae[ao.getId()];S(an,ao)}}});var S=function(at,ao){var aq=at.endpoints[0].getParameters(),ar=at.endpoints[1].getParameters(),ap=aq.nodeId+(aq.portId?"."+aq.portId:""),an=ar.nodeId+(ar.portId?"."+ar.portId:"");C.fire(e.edgeRemoved,{sourceNodeId:aq.nodeId,targetNodeId:ar.nodeId,sourcePortId:aq.portId,targetPortId:ar.portId,sourceId:ap,targetId:an,source:w.getNode(ap),target:w.getNode(an),edge:ao})};w.bind(e.graphCleared,function(){for(var an in ai){I.remove(ai[an])}ad&&ad.clear();I.deleteEveryEndpoint();ae={};ai={}});w.bind(e.portAdded,function(ao){var an=ai[ao.node.id];var ap=v(ao.port,ao.data,ao.node);F[ao.node.id+"."+ao.port.id]=ap;aj(x.getDOMElement(ap),ao.node,ao.node.id);C.fire(e.portAdded,{node:ao.node,nodeEl:an,port:ao.port,portEl:ap});I.recalculateOffsets(an);C.refresh()});w.bind(e.portRemoved,function(ap){var ao=ai[ap.node.id],an=ap.node.id+"."+ap.port.id,aq=F[an];I.setSuspendEvents(true);I.remove(aq);I.setSuspendEvents(false);delete F[an];C.fire(e.portRemoved,{node:ap.node,port:ap.port,portEl:aq});I.recalculateOffsets(ao);C.refresh()});var G=jsPlumbUtil.merge(w.getPalette(),u.palette||{}),ag=new jsPlumbToolkit.Palette(G,I);var J=function(ao){var ap={type:ak(ao.data),data:ao.data,cost:ao.getCost(),directed:ao.isDirected()};var an=function(ar){if(ao[ar].getNode){var au=ao[ar].getNode(),at=au.id+"."+ao[ar].id,aq=N[at];if(aq==null){aq=W[ar][at]}ap[ar]=aq}else{ap[ar]=M(ao[ar].data)}};an("source");an("target");return ap};var B=function(ao,at,av,ar,an,ap,aq,au){return function(aE,aH,aB){var ay=at(aH),aI=document.getElementById(ay),aG=null;if(!aI){var aw=av(aH),aA=ar(aw);var az=jsPlumb.extend({},aA?aA.parameters||{}:{});jsPlumb.extend(az,aH);var aD={};for(var aF in az){if(az[aF]!=null){if(az[aF].constructor==Function){aD[aF]=az[aF](aH)}else{aD[aF]=az[aF]}}}if(aA&&aA.template){if(!aA.templateRenderer){aG=L.render(aA.template,aD,I.getRenderMode())}else{aG=aA.templateRenderer(aA.template,aD,I.getRenderMode())}}else{aG=an(aD,ay)}var ax=x.getElementObject(aG);x.setAttribute(ax,"id",ay);x.setAttribute(ax,au,ay);x.addClass(ax,aq);aG.jtk=aG.jtk||{};aG.jtk[ao]=aE;aG.jtk.node=aB;if(ap&&ah){C.makeDraggable(aG)}var aC=function(aJ){x.bind(ax,aJ,function(){aA.events[aJ]({node:aB,el:aG})})};if(aA&&aA.events){for(var aF in aA.events){aC(aF)}}return aG}else{aI.jtk={node:aB};return x.getElementObject(aI)}}};var V=B("node",M,Z,ag.getNodeDefinition,p,true,r.NODE,o.NODE);var v=B("port",am,aa,ag.getPortDefinition,p,false,r.PORT,o.PORT);C.initialize=function(){w.setSuspendGraph(true);I.setSuspendDrawing(true);for(var ar=0;ar<w.getNodeCount();ar++){var au=w.getNodeAt(ar);var aq=V(au,au.data,au);C.append(aq);ai[au.id]=aq;aj(x.getDOMElement(aq),au,au.id)}for(var ar=0;ar<w.getNodeCount();ar++){var au=w.getNodeAt(ar),ao=au.getAllEdges();for(var ap=0;ap<ao.length;ap++){if(ao[ap].source==au||ao[ap].source.getNode&&ao[ap].source.getNode()==au){var an=J(ao[ap]);an.doNotFireConnectionEvent=true;var at=I.connect(an);at.edge=ao[ap];ae[ao[ap].getId()]=at;U(an.type,ao[ap],at)}}}if(ad){ad.relayout()}I.setSuspendDrawing(false,true);w.setSuspendGraph(false)};C.getContainer=function(){return R};C.getContainerId=function(){return al};C.setLayout=function(an){if(an){var ao=I.extend({container:R},an);ad=w.layout(ao,C)}};C.getLayout=function(){return ad};C.refresh=function(){if(!H){if(ad){ad.layout()}I.repaintEverything()}};C.redrawEdge=function(an){ae[an.getId()].reapplyTypes(an.data)};C.relayout=function(an){if(!H){if(ad){ad.relayout(an)}I.repaintEverything()}};C.draggable=function(an,ao){ao.doNotRemoveHelper=true;I.draggable(an,ao)};var N={},W={source:{},target:{}};var K=function(ao,an){return function(ap,au){var at=ap.target||ap.srcElement,ar=false,av=I.getSelector(ao,an);for(var aq=0;aq<av.length;aq++){if(av[aq]==at){ar=true;break}}return ar}};var aj=function(ap,au,at){var an=function(aF){var aG=aF.getAttribute("port-id"),ay=aF.getAttribute("port-type")||"default",aL=aF.getAttribute("scope")||I.getDefaultScope(),aD=Z(au),aJ=ag.getNodeDefinition(aD),aI=ag.getPortDefinition(aG,aJ),aC=ag.getPortDefinition(ay,aJ),aM=jsPlumbUtil.merge(aC,aI),aB=aM==null?{}:jsPlumbToolkitUtil.populate(aM,au),aA=function(aN){return function(aR){var aQ=aR.endpoint.getParameters(),aO=au.getPort(aG),aP=[{portId:aG,nodeId:at,port:aO,node:au,portType:ay,endpoint:aR.endpoint,anchor:aR.anchor}];aN.apply(aN,aP)}};if(aB.edgeType){var aH={paintStyle:"connectorStyle",hoverPaintStyle:"connectorHoverStyle",overlays:"connectorOverlays",endpointStyle:"paintStyle"},aK=ag.getEdgeDefinition(aB.edgeType);if(aK){for(var aE in aK){var az=aH[aE]||aE;aB[az]=aK[aE]}}aB.connectionType=aB.edgeType}aB.portId=aG;aB.portType=ay;aB.scope=aL;aB.parameters=aB.parameters||{};aB.parameters.portId=aG;aB.parameters.portType=ay;aB.parameters.scope=aL;aB.parameters.nodeId=at;aB.events={};if(aM.events){for(var aE in aM.events){aB.events[aE]=aA(aM.events[aE])}}aB.events.anchorChanged=function(aN){C.fire("anchorChanged",{portId:aG,nodeId:at,portType:ay,node:au,port:au.getPort(aG),endpoint:aN.endpoint,anchor:aN.anchor})};return aB};if(ap.childNodes){var aw=[];for(var av=0;av<ap.childNodes.length;av++){if(ap.childNodes[av].nodeType!=3&&ap.childNodes[av].nodeType!=8){if(ap.childNodes[av].tagName.toUpperCase()=="JTK-PORT"){var aq=an(ap.childNodes[av]);var ax=I.addEndpoint(ap,aq);N[at+"."+aq.portId]=ax;var ar=au.addPort({id:aq.portId});aw.push(ap.childNodes[av]);ax.graph={node:au,port:ar}}if(ap.childNodes[av].tagName.toUpperCase()=="JTK-SOURCE"){var aq=an(ap.childNodes[av]);var ao=ap.childNodes[av].getAttribute("filter-selector");W.source[at+"."+aq.portId]=ap;au.addPort({id:aq.portId});if(ao){aq.filter=ao}I.makeSource(ap,aq);aw.push(ap.childNodes[av])}if(ap.childNodes[av].tagName.toUpperCase()=="JTK-TARGET"){var aq=an(ap.childNodes[av]);var ao=ap.childNodes[av].getAttribute("filter-selector");W.target[at+"."+aq.portId]=ap;au.addPort({id:aq.portId});I.makeTarget(ap,aq);aw.push(ap.childNodes[av])}aj(ap.childNodes[av],au,at)}}for(var av=0;av<aw.length;av++){aw[av].parentNode.removeChild(aw[av])}}};C.setLayout(u.layout);return{jsPlumb:I,toolkit:w,container:R,containerId:al,getConnectionsForEdges:Q,getConnectionForEdge:Y,getObjectInfo:function(aq){var ao={el:null,obj:null,type:null,id:null},ap=function(at){if(at!=null){if(at.jtk){return at}return ap(at.parentNode)}};if(aq!=null){var ar=x.getDOMElement(aq);if(ar!=null&&ar.jtk){ao.el=ar;ao.obj=ar.jtk.port||ar.jtk.node;ao.type=ar.jtk.port?"port":"node"}else{if(aq.tagName!==null){var an=ap(ar);if(an!=null){ao.el=an;ao.obj=an.jtk.port||an.jtk.node;ao.type=an.jtk.port?"port":"node"}}else{ao.obj=aq;ao.el=aq.getNode?F[aq.id]:ai[aq.id];ao.type=aq.getNode?"port":"node"}}}return ao}}};jsPlumbToolkit.Renderers.DOM=function(u){i.apply(this,arguments);n.apply(this,arguments)};jsPlumbToolkit.Renderers.Surface=function(bq){var bm=this;var a7=i.apply(this,arguments);n.apply(this,arguments);this.getObjectInfo=a7.getObjectInfo;bq=bq||{};var aY=jsPlumb.CurrentLibrary,bd=aY.getElementObject(bq.container),bk=aY.getDOMElement(bd),w=!(bq.elementsDraggable===false),aS=bq.dragOptions||{},au=bq.dropOptions||{},bn=!(bq.pannable===false),aK=!(bq.selectable===false),ab=bq.padding||20,a6=bq.panDistance||50,aE=bq.autoPanIncrement||5,bl=bq.activeMargin||60,ac=[],ah={},bc={},bC=aY.getSize(bd),bj=0,aZ=0,L=bq.maximumZoomTravel||150,ag=!(bq.zoomable===false),aV=bq.zoomRange||[0.2,3],a3=((/iphone|ipad/gi).test(navigator.appVersion)),D=a3?e.touchstart:e.mousedown,G=a3?e.touchend:e.mouseup,B=a3?e.touchmove:e.mousemove,O=bq.saveStateOnExit,ba=bq.saveStateOnDrag,bA=bq.stateHandle,R=!(bq.consumeRightClick===false);var bo=q({position:f.relative,width:"300px",height:"300px",left:0,top:0,clazz:r.SURFACE_CANVAS},bd),bD=aY.getElementObject(bo),ak=q({position:f.absolute,width:"5px",height:"5px",left:0,top:0,clazz:r.SURFACE_LASSO},bD),am=aY.getElementObject(ak);aY.bind(bd,e.click,function(bF){bm.fire("canvasClick",bd,bF)});a7.toolkit.bind(e.nodeRemoved,function(bF){delete ah[bF.node.id]});ak.style.display=f.none;bm.getJsPlumb().Defaults.Container=bD;bm._contentDimensions={width:0,height:0,minLeft:0,minTop:0,maxLeft:0,maxTop:0};bm._canvasElement={width:300,height:300,left:0,top:0};var ar={left:function(bF,bG){return{left:0,top:0,width:bF,height:"100%",clazz:r.SURFACE_PAN_LEFT}},right:function(bF,bG){return{right:0,top:0,width:bF,height:"100%",clazz:r.SURFACE_PAN_RIGHT}},top:function(bF,bG){return{left:0,top:0,width:"100%",height:bF,clazz:r.SURFACE_PAN_TOP}},bottom:function(bF,bG){return{left:0,bottom:0,width:"100%",height:bF,clazz:r.SURFACE_PAN_BOTTOM}}},bu=bq.panStartInterval||250,ad=bq.autoPanRate||50,E=null,Z=null,aU=false,K=null,at=null,aq=null,bx=false,ae=function(bN,bF,bJ,bM,bH){var bK=bJ.getSize(bF),bO="30px",bG=ar[bN](bO,bK),bI=a7.jsPlumb.getId(bF),bP=bI+"_jsptp_"+bN,bL=q({left:bG.left,top:bG.top,right:bG.right,bottom:bG.bottom,width:bG.width,height:bG.height,display:f.none,id:bP,clazz:r.SURFACE_PAN+" "+bG.clazz},bF);bJ.bind(bL,e.click,function(){window.clearTimeout(aq);if(!aU){bM();if(at){bJ.removeClass(at,r.SURFACE_PAN_ACTIVE);at=null}}aU=false});bJ.bind(bL,D,function(){window.clearTimeout(aq);bJ.addClass(bL,r.SURFACE_PAN_ACTIVE);at=bL;E=window.setTimeout(function(){aU=true;Z=window.setInterval(bH,ad)},bu)})},ax=function(bF,bH){window.clearTimeout(aq);if(!bx&&!bh&&!a9){var bI=a7.jsPlumb.getId(bF)+"_jsptp_"+bH,bG=document.getElementById(bI);if(bG){bG.style.display=f.block}aq=window.setTimeout(a2,650)}},a2=function(bF){$("."+r.SURFACE_PAN).fadeOut()};aY.bind(document,G,function(){window.clearTimeout(E);K=null;window.clearInterval(Z);if(at){aY.removeClass(at,r.SURFACE_PAN_ACTIVE);at=null}});bk.style.overflow=f.hidden;aY.addClass(bd,r.SURFACE);var a5={leftmin:[],leftmax:[],topmin:[],topmax:[]},bp=function(bF,bH,bJ){var bI=false;for(var bG=0;bG<a5[bH].length;bG++){if(a5[bH][bG][1]==bF){a5[bH][bG][0]=bJ;bI=true;break}}if(!bI){a5[bH].push([bJ,bF])}},bE=function(bG,bI){var bF=-1;for(var bH=0;bH<a5[bI].length;bH++){if(a5[bI][bH][1]==bG){bF=bH;break}}if(bF>-1){a5[bI].splice(bF,1)}},X=function(bF){return a5[bF+f.min].length>0?a5[bF+f.min][0]:0},Q=function(bF){return a5[bF+f.max].length>0?a5[bF+f.max][a5[bF+f.max].length-1]:0},bi=function(){var bG=bm._canvasElement.width*aA.curZoom,bH=bm._canvasElement.height*aA.curZoom,bF=bm._canvasElement.left+(A*bm._canvasElement.width),bI=bm._canvasElement.top+(x*bm._canvasElement.height);return[bF-(A*bG),bI-(x*bH)]},P=function(){var bG=function(bL,bK){if(bL[0]<bK[0]){return -1}if(bL[0]>bK[0]){return 1}return 0};a5[f.leftmin].sort(bG);a5[f.topmin].sort(bG);a5[f.leftmax].sort(bG);a5[f.topmax].sort(bG);var bI=X(f.left)[0],bF=Q(f.left)[0],bJ=X(f.top)[0],bH=Q(f.top)[0];bj=bF-bI;aZ=bH-bJ;bm._contentDimensions={minLeft:bI,minTop:bJ,maxLeft:bF,maxTop:bH,width:bj,height:aZ};aQ(e.contentDimensions)},v=function(bF,bH,bG){if(!ah[bF]){ah[bF]={}}ah[bF].loc=bH;bp(bF,f.leftmin,bH.left);bp(bF,f.topmin,bH.top);bp(bF,f.leftmax,bH.left+bG[0]);bp(bF,f.topmax,bH.top+bG[1]);P()},av=function(bF){bE(bF,f.leftmin);bE(bF,f.topmin);bE(bF,f.leftmax);bE(bF,f.topmax);P()},bg=function(bH,bF){bH=aY.getElementObject(bH);var bJ=a7.jsPlumb.getId(bH),bG=aY.getSize(bH),bI=h(bF);v(bJ,bI,bG);return bI},bf=bm.setOffset,aH=function(bH){bH=aY.getElementObject(bH);aY.appendElement(bH,bD);var bF=aY.getDOMElement(bH),bI=bg(bH,bF),bJ=a7.jsPlumb.getId(bH),bG=aY.getSize(bH);ah[bJ]={el:bH,id:bJ,loc:bI,size:bG,node:bF.jtk.node};aQ(e.elementAdded,{id:bJ,el:bF,offset:bI,size:bG,canvasOffset:aY.getOffset(bD),width:bj,height:aZ})},bz=function(bG){bG=aY.getElementObject(bG);var bF=a7.jsPlumb.getId(bG),bI=aY.getDOMElement(bG);if(w){var bK=a7.jsPlumb.extend({},aS),bH=aY.dragEvents[e.stop],bL=aY.dragEvents[e.drag],bJ=aY.dragEvents[e.start],bN=null,bM=function(bO){var bR=aY.getDragObject(bO),bQ=aY.getDOMElement(bR),bS=bQ.getAttribute("id"),bT=bm.getNodePosition(bS),bP=bQ.jtk.node;return{node:bP,el:bR,pos:bT}};bK[bJ]=a7.jsPlumb.wrap(bK[bJ],function(){bN=aY.getOffset(bD);bm.fire(e.nodeMoveStart,bM(arguments))});bK[bH]=a7.jsPlumb.wrap(bK[bH],function(){bx=false;var bO=bg(bG,bI);aA.dragStop(bI);if(bm.getLayout()!=null){bm.getLayout().setUserPosition(bI.jtk.node.id,bO.left,bO.top)}if(ba&&bA){bm.State.save()}bm.fire(e.nodeMoveEnd,bM(arguments))});bK[bL]=a7.jsPlumb.wrap(bK[bL],function(){var bP=aY.getUIPosition(arguments);var bO={left:bP.left-bN.left,top:bP.top-bN.top};ah[bF].loc=bO;aQ(e.elementDragged,{id:bF,el:bI})});a7.jsPlumb.draggable(bG,bK)}},aN=function(bG){bG=aY.getElementObject(bG);var bH=a7.jsPlumb.getId(bG),bF=aY.getDOMElement(bG);delete ah[bH];av(bH);aY.removeElement(bG);aQ(e.elementRemoved,{id:bH,el:bF,canvasOffset:aY.getOffset(bD),width:bj,height:aZ})},a0=function(bH,bK,bP){var bQ=aY.getSize(bD),bJ=aY.getSize(bd),bR=0,bO=0,bN=(1-bP)*bQ[0]/2,bM=(1-bP)*bQ[1]/2,bI=(ab*bP)-(bH+bN+(Q(f.left)[0]*bP)),bF=(ab*bP)-(bK+bM+(Q(f.top)[0]*bP)),bG=(bJ[0]-(ab*bP))-(bH+bN+(X(f.left)[0]*bP)),bL=(bJ[1]-(ab*bP))-(bK+bM+(X(f.top)[0]*bP));if(bI>0){bR+=bI}if(bF>0){bO+=bF}if(bG<0){bR+=bG}if(bL<0){bO+=bL}return[bR,bO]},a1=function(bJ,bM,bK){if(bn){bx=true;var bH=j(bo,aA.curZoom),bF=bH.left+bJ,bG=bH.top+bM,bN=a0(bF,bG,aA.curZoom);if(!bK){var bL={left:f.plusEquals+(bJ+bN[0]),top:f.plusEquals+(bM+bN[1])},bI={left:(bJ+bN[0]),top:(bM+bN[1])};a7.jsPlumb.getId(bD);a7.jsPlumb.animate(bD,bL);bm.fire(e.pan);aQ(e.pan,{args:bI,animate:true})}else{bm._canvasElement.left=bF+bN[0];bm._canvasElement.top=bG+bN[1];bo.style.left=bm._canvasElement.left+f.px;bo.style.top=bm._canvasElement.top+f.px;bm.fire(e.pan);aQ(e.pan,{left:bF+bN[0],top:bG+bN[1],animate:false})}}},aF=function(bH,bG,bF){return function(){a1(bH,bG,bF)}},be=function(bF,bJ){if(bn){var bH=bv.left+bF,bG=bv.top+bJ,bI=a0(bH,bG,aA.curZoom);bm._canvasElement.left=bH+bI[0];bm._canvasElement.top=bG+bI[1];bo.style.left=bm._canvasElement.left+f.px;bo.style.top=bm._canvasElement.top+f.px;bm.fire(e.pan);aQ(e.pan,{left:bH+bI[0],top:bG+bI[1],animate:false})}},ao=function(bH,bG,bF){if(bG<(-L)){bG=(-L)}if(bG>L){bG=L}T(N,bG,(-L),L,bF)},W=aF(-a6,0),an=aF(a6,0),bt=aF(0,-a6),aG=aF(0,a6),aM=aF(-a6,-a6),aJ=aF(a6,-a6),V=aF(-a6,a6),aj=aF(a6,a6),al=aF(-aE,0,true),aT=aF(aE,0,true),a4=aF(0,-aE,true),br=aF(0,aE,true),aP=aF(-aE,-aE,true),ai=aF(aE,-aE,true),a8=aF(-aE,aE,true),aa=aF(aE,aE,true),Y=function(){return j(bo,aA.curZoom)},S=null,N=null,bh=false,bB=false,F=false,bv=null,a9=false,by=[],aR=function(){bv=j(bo,aA.curZoom)},aQ=function(bG,bH){for(var bF=0;bF<ac.length;bF++){try{ac[bF][bG](bH)}catch(bI){console.log("oh dear!",bI,bG)}}},ay=function(bF){ac.push(bF);bF.init({width:bj,height:aZ,viewport:bd,canvas:bo})},aL=function(bF){var bG=ac.indexOf(bF);if(bG>-1){ac.splice(bG,1)}},az=function(bF){if(y[bF]!=null){if(aX!=null){aX.cleanup()}aX=y[bF];bm.fire(e.modeChanged,bF)}},H=function(bF){if(bF.pageX){return[bF.pageX,bF.pageY]}else{if(bF.page&&bF.page.x){return[bF.page.x,bF.page.y]}else{return[bF.originalEvent.touches[0].pageX,bF.originalEvent.touches[0].pageY]}}},aD=function(bF){by.push(bF);aY.addClass(bF.el,r.SURFACE_SELECTED_ELEMENT)},z=function(bF){aY.removeClass(bF.el,r.SURFACE_SELECTED_ELEMENT)},aB=function(){for(var bF=0;bF<by.length;bF++){z(by[bF])}by=[];ak.style.display=f.none;ak.style.width=f.nopx;ak.style.height=f.nopx},u=function(){by=[];for(var bF in ah){aD(ah[bF])}},y={PAN:{id:"pan",isEnabled:function(){return bn||ag},start:function(bF){if(bF.which<3){bB=true;F=false}else{F=true;bB=false}},step:function(bH){var bI=H(bH),bG=bI[0]-bk.scrollLeft-S[0],bF=bI[1]-bk.scrollTop-S[1];if(F){ao(bG,bF,S)}else{be(bG,bF)}},stop:function(bF){bB=false;F=false},cleanup:function(){},click:function(bF){}},SELECT:{id:"select",isEnabled:function(){return aK},start:function(bF){y.SELECT.cleanup();ak.style.width=f.nopx;ak.style.height=f.nopx;ak.style.display=f.block;var bG=aY.getOffset(bD);k(ak,S[0]-bG.left,S[1]-bG.top)},step:function(bJ){var bI=H(bJ),bK=[bI[0]-bk.scrollLeft,bI[1]-bk.scrollTop],bO=Math.abs(bK[0]-S[0]),bH=Math.abs(bK[1]-S[1]),bN=Math.min(S[0],bK[0]),bL=Math.min(S[1],bK[1]),bM=aY.getOffset(bD);k(ak,bN-bM.left,bL-bM.top);ak.style.width=bO+f.px;ak.style.height=bH+f.px;by=[];for(var bG in ah){var bF=jsPlumbUtil.intersects({x:bN-bM.left,y:bL-bM.top,w:bO,h:bH},{x:ah[bG].loc.left,y:ah[bG].loc.top,w:ah[bG].size[0],h:ah[bG].size[1],});if(bF){aD(ah[bG])}else{z(ah[bG])}}},stop:function(bF){ak.style.display=f.none;ak.style.width=f.nopx;ak.style.height=f.nopx},cleanup:function(){},click:function(bF){aB()}}},aX=y.PAN,bs=function(bF){if(aX!=null&&aX.isEnabled()&&bF.target==bk||bF.target==bo){bh=true;var bG=H(bF);S=[bG[0]-bk.scrollLeft,bG[1]-bk.scrollTop];N=aA.curZoom;_apparentCanvasOriginWhenMouseDown=bi();aR();aX.start(bF);bF.stopPropagation();bF.preventDefault()}},I=function(bG,bF){return function(bH){bG(bH);if(bF==null||bF(bH)){bH.preventDefault();bH.stopPropagation()}}},af=function(bF){if(aX!=null&&aX.isEnabled()&&bh){aX.step(bF)}},aO=function(bG){if(aX!=null&&aX.isEnabled()&&bh){var bF=(bx==true);bx=false;bh=false;S=null;if(bF){bG.preventDefault();return false}aX.stop(bG)}},C=function(bF){if(aX!=null&&aX.isEnabled()){aX.click(bF)}bh=false},A=0.5,x=0.5,bb=function(){return(A*100)+"% "+(x*100)+"%"},J=["-moz-transform","-webkit-transform","-o-transform","transform","-ms-transform"],aw=jsPlumbToolkitUtil.getInternetExplorerVersion(),ap=aw>0&&aw<9,aA=new c(bo),U=function(bH,bF){if(ag){aA.zoom(bH);a7.jsPlumb.setZoom(bH);var bI=j(bo,aA.curZoom);var bG=a0(bI.left,bI.top,aA.curZoom);bm._canvasElement.left=bI.left+bG[0];bm._canvasElement.top=bI.top+bG[1];bo.style.left=bm._canvasElement.left+f.px;bo.style.top=bm._canvasElement.top+f.px}return aA.curZoom},aI=function(bG,bF,bI){var bH=aA.curZoom+bG;if(bH>aV[0]&&bH<aV[1]){U(bH,bF,bI)}},T=function(bI,bK,bH,bJ,bG){var bL=bK/((bK>=0)?bJ:bH),bF=bK>=0?1:0,bM=bI+(bL*(aV[bF]-bI));U(bM,bG)},aW=function(bO){if(ag){bO=bO||20;var bI=[X("left"),X("top")],bM=[Q("left"),Q("top")],bQ=(bM[0][0]-bI[0][0])+bO,bJ=(bM[1][0]-bI[1][0])+bO,bR=(bM[0][0]+bI[0][0])/4,bP=(bM[1][0]+bI[1][0])/4,bK=aY.getOffset(bd),bF=aY.getSize(bd),bH=bF[0]/bQ,bG=bF[1]/bJ,bN=Math.min(bH,bG),bL=bN<1?bN:1;bm._canvasElement.left=bR;bm._canvasElement.top=bP;bo.style.left=bm._canvasElement.left+f.px;bo.style.top=bm._canvasElement.top+f.px;U(bL);console.log(bI,bM,bQ,bJ,bK,bF)}};bm.centerOn=function(bH,bL){var bG=a7.getObjectInfo(bH),bM=aY.getElementObject(bG.el),bO=aY.getSize(bM),bJ=bi(),bI=ah[bG.obj.id].loc.left,bN=ah[bG.obj.id].loc.top,bK=aY.getOffset(bd),bF=aY.getSize(bd);a1(((bF[0]-bO[0])/2)-(bJ[0]+bI),((bF[1]-bO[1])/2)-(bJ[1]+bN),bL)};bm.getNodePositions=function(bG){var bH={};for(var bF in ah){bH[bF]=bm.getNodePosition(bF,bG)}return bH};bm.getNodePosition=function(bI,bH){var bG=bH?(-1*a5.leftmin[0][0]):0,bF=bH?(-1*a5.topmin[0][0]):0;return[ah[bI].loc.left+bG,ah[bI].loc.top+bF,]};bm.mapEventLocation=function(bG,bK){var bF=bi(),bO=bK?0:bG.offsetX,bM=bG.pageX-bO,bN=bK?0:bG.offsetY,bL=bG.pageY-bN,bH=aY.getOffset(bd),bJ=bM-bH.left,bI=bL-bH.top;return{left:parseInt((bJ-bF[0])/aA.curZoom),top:parseInt((bI-bF[1])/aA.curZoom)}};bm.storePositionsInModel=function(bK){bK=bK||{};var bJ=bK.leftAttribute||"left",bF=bK.topAttribute||"top";var bI=bm.getNodePositions();for(var bG in bI){var bH=ah[bG].node;bH.data[bJ]=bI[bG][0];bH.data[bF]=bI[bG][1]}};bm.storePositionInModel=function(bI){var bH=bI.leftAttribute||"left",bF=bI.topAttribute||"top",bG=bm.getNodePosition(bI.id);ah[id].node.data[bH]=bG[0];ah[id].node.data[bF]=bG[1];return bG};bm.setOffset=function(bF,bG){var bH=aY.getDOMElement(bF);bH.style.left=bG.left+"px";bH.style.top=bG.top+"px";bg(bF,bH)};bm.setPageOffset=function(bG,bJ){var bI=aY.getOffset(bd),bF=bJ.left-bI.left,bH=bJ.top-bI.top;bm.setOffset(bG,{left:bF/aA.curZoom,top:bH/aA.curZoom})};bm.makeDropTarget=function(bF){aY.initDroppable(bd,bF)};var bw=function(bF){bF=bF||{};var bJ=bF.dataGenerator||function(){return{}},bI=bF.typeExtractor,bM=bF.droppables,bL=bF.dragOptions||{},bG=bF.dropOptions||{},bN="scope_"+(new Date()).getTime(),bH=function(bT,bS){var bR=aY.getDragObject(arguments),bO=bI(bR),bQ=bJ(bO),bP=bm.mapEventLocation(bT);bQ.left=bP.left;bQ.top=bP.top;a7.toolkit.getNodeFactory()(bO,bQ,function(bU){a7.toolkit.addNode(bU)})};bG.scope=bN;bG.drop=jsPlumb.wrap(bG.drop,bH);aY.initDroppable(bd,bG);bL.scope=bN;bL.helper="clone";bL.doNotRemoveHelper=true;for(var bK=0;bK<bM.length;bK++){aY.initDraggable(aY.getElementObject(bM[bK]),bL)}};bm.registerDroppableNodes=function(bF){new bw(bF)};bm.select=function(bF){};var M=function(bJ,bI){var bH=jsPlumb.extend({},bJ);bH.source=a7.getObjectInfo(bJ.source).obj;bH.target=a7.getObjectInfo(bJ.target).obj;bH.element=a7.getObjectInfo(bJ.element).obj;var bF=a7.toolkit[bI](bH),bG=a7.getConnectionsForEdges(bF);return a7.jsPlumb.select({connections:bG})};bm.selectEdges=function(bF){return M(bF,"selectEdges")};bm.selectAllEdges=function(bF){return M(bF,"selectAllEdges")};bm.repaint=function(bG){var bF=a7.getObjectInfo(bG).el;if(bF){a7.jsPlumb.recalculateOffsets(bF);a7.jsPlumb.repaint(a7.jsPlumb.getId(bF));bm.fire(e.objectRepainted,bF)}};bm.setConsumeRightClick=function(bF){R=bF};aY.bind(bd,D,bs);aY.bind(bd,e.contextmenu,new I(bs,function(){return R}));aY.bind(document,B,af);aY.bind(bd,G,aO);aY.bind(document,G,aO);aY.bind(document,e.click,C);aY.bind(bD,G,aO);aY.bind(bd,B,function(bG){var bF=aY.getElementObject(bG.target);if(aY.hasClass(bF,r.SURFACE)||aY.hasClass(bF,r.SURFACE_CANVAS)){if(bG.offsetY<bl){ax(bd,f.top)}else{if(bG.offsetX<bl){ax(bd,f.left)}else{if(bG.offsetX>bC[0]-bl){ax(bd,f.right)}else{if(bG.offsetY>bC[1]-bl){ax(bd,f.bottom)}else{a2()}}}}}});ae(f.left,bd,aY,W,al);ae(f.right,bd,aY,an,aT);ae(f.top,bd,aY,bt,a4);ae(f.bottom,bd,aY,aG,br);a7.jsPlumb.bind(bd,e.mouseout,function(){$(f.dot+r.SURFACE_PAN).fadeOut()});aY.setAttribute(bd,"data-jtk-surface","true");bm.State={save:function(bG){bG=bG||bA;var bH=h(bo),bF=bH.left+" "+bH.top+" "+aA.curZoom+" ";for(var bI in ah){bF+=(bI+" "+ah[bI].loc.left+" "+ah[bI].loc.top+" ")}jsPlumbToolkit.util.Storage.set("jtk-state-"+bG,bF)},restore:function(bH){bH=bH||bA;var bG=jsPlumbToolkit.util.Storage.get("jtk-state-"+bH);if(bG){_s=bG.split(" ");bo.style.left=_s[0]+"px";bo.style.top=_s[1]+"px";for(var bF=3;bF<_s.length;bF+=3){var bJ=_s[bF],bI=document.getElementById(bJ);if(ah[bJ]&&bI){if(!ah[bJ].loc){ah[bJ].loc={}}ah[bJ].loc.left=_s[bF+1];ah[bJ].loc.top=_s[bF+2];k(bI,_s[bF+1],_s[bF+2])}}U(parseFloat(_s[2]))}},clear:function(bF){bF=bF||bA;jsPlumbToolkit.util.Storage.clear("jtk-state-"+bF)},clearAll:function(){jsPlumbToolkit.util.Storage.clearAll()}};bm.saveState=bm.State.save;bm.restoreState=function(bF){bm.State.restore(bF);bm.getJsPlumb().repaintEverything()};bm.clearState=function(bF){bm.state.clear(bF)};aY.bind(window,e.unload,function(){if(O&&bA){bm.State.save()}});if(bq.events){for(var aC in bq.events){bm.bind(aC,bq.events[aC])}}bm.getContainer=function(){return bd};bm.append=aH;bm.remove=aN;bm.isPannable=function(){return bn===true};bm.setPannable=function(bF){bn=(bF===true)};bm.pan=a1;bm.getPan=Y;bm.setMode=az;bm.deselectAll=aB;bm.selectAll=u;bm.makeDraggable=bz;bm._moveBy=be;bm._storeCanvasPosition=aR;bm._disablePanButtons=function(){a9=true};bm._enablePanButtons=function(){a9=false};bm.panLeft=W;bm.panRight=an;bm.panUp=bt;bm.panDown=aG;bm.panUpLeft=aM;bm.panUpRight=aJ;bm.panDownLeft=V;bm.panDownRight=aj;bm.registerMiniview=ay;bm.unregisterMiniview=aL;bm.setZoom=U;bm.zoomToFit=aW;bm.getZoom=function(){return aA.curZoom}};jsPlumbToolkit.NodePalette=function(x){x=x||{};var B=jsPlumb.CurrentLibrary,G=x.toolkit,v=B.getElementObject(x.container),J=B.getDOMElement(v),w=x.orientation||"vertical",H=function(K){var L=document.createElement("div");L.innerHTML=K.name;return L},u=x.renderFunction||H,F=x.renderer,E=jsPlumbToolkitUtil.uuid(),D=document.createElement("ul"),y=x.data||[];D.className=r.NODE_PALETTE;J.appendChild(D);var A=function(K){if(I!=null&&K.node.data==I){F.setPageOffset(K.el,z)}I=null},I=null,z=null;F.bind(e.nodeAdded,A);F.makeDropTarget({drop:function(P,O){var N=B.getDragObject(arguments),K=B.getAttribute(N,"data-index"),M=B.getAttribute(N,"data-type");z=F.mapEventLocation(P);var L=jsPlumbUtil.clone(y[K]||{});L.left=z.left;L.top=z.top;G.getNodeFactory()(M,L,function(Q){I=Q;G.addNode(Q)})},scope:E});var C=function(){D.innerHTML="";for(var L=0;L<y.length;L++){var M=u(y[L]),K=document.createElement("li");K.appendChild(M);K.className=r.NODE_PALETTE_ENTRY;K.setAttribute("data-type",y[L].type);K.setAttribute("data-index",L);if(w!="vertical"){K.style.display="inline"}D.appendChild(K);B.initDraggable(B.getElementObject(K),{scope:E,helper:"clone",doNotRemoveHelper:true})}};C()};jsPlumbToolkit.DefaultRendererType="Surface"})();