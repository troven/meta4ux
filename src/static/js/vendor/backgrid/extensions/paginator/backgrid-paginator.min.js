/*
  backgrid-paginator
  http://github.com/wyuenho/backgrid

  Copyright (c) 2013 Jimmy Yuen Ho Wong and contributors
  Licensed under the MIT @license.
*/
(function(e,t,s,i){"use strict";i.Extension.Paginator=s.View.extend({className:"backgrid-paginator",windowSize:10,fastForwardHandleLabels:{first:"《",prev:"〈",next:"〉",last:"》"},template:t.template('<ul><% _.each(handles, function (handle) { %><li <% if (handle.className) { %>class="<%= handle.className %>"<% } %>><a href="#" <% if (handle.title) {%> title="<%= handle.title %>"<% } %>><%= handle.label %></a></li><% }); %></ul>'),events:{"click a":"changePage"},initialize:function(e){i.requireOptions(e,["columns","collection"]),this.columns=e.columns,this.columns instanceof s.Collection||(this.columns=new i.Columns(this.columns));var t=this.columns;this.listenTo(t,"add",this.render),this.listenTo(t,"remove",this.render),this.listenTo(t,"change:renderable",this.render);var a=this.collection,l=a.fullCollection;l?(this.listenTo(l,"add",this.render),this.listenTo(l,"remove",this.render),this.listenTo(l,"reset",this.render)):(this.listenTo(a,"add",this.render),this.listenTo(a,"remove",this.render),this.listenTo(a,"reset",this.render))},changePage:function(t){t.preventDefault();var s=e(t.target).text(),i=this.fastForwardHandleLabels,a=this.collection;if(i)switch(s){case i.first:return a.getFirstPage(),void 0;case i.prev:return a.hasPrevious()&&a.getPreviousPage(),void 0;case i.next:return a.hasNext()&&a.getNextPage(),void 0;case i.last:return a.getLastPage(),void 0}var l=a.state,n=1*e(t.target).text();a.getPage(0===l.firstPage?n-1:n)},makeHandles:function(){var e=[],t=this.collection,s=t.state,i=s.lastPage?s.lastPage:s.firstPage;i=0===s.firstPage?i:i-1;var a=0===s.firstPage?s.currentPage:s.currentPage-1,l=Math.floor(a/this.windowSize)*this.windowSize,n=l+this.windowSize;if(n=i>=n?n:i+1,"infinite"!==t.mode)for(var r=l;n>r;r++)e.push({label:r+1,title:"No. "+(r+1),className:a===r?"active":void 0});var o=this.fastForwardHandleLabels;return o&&(o.prev&&e.unshift({label:o.prev,className:t.hasPrevious()?void 0:"disabled"}),o.first&&e.unshift({label:o.first,className:t.hasPrevious()?void 0:"disabled"}),o.next&&e.push({label:o.next,className:t.hasNext()?void 0:"disabled"}),o.last&&e.push({label:o.last,className:t.hasNext()?void 0:"disabled"})),e},render:function(){return this.$el.empty(),this.$el.append(this.template({handles:this.makeHandles()})),this.delegateEvents(),this}})})(jQuery,_,Backbone,Backgrid);